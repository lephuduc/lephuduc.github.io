---
title: "CORCTF 2022"
description: "Writeup for CORCTF 2022"
summary: "Writeup for CORCTF 2022"
categories: ["Writeup"]
tags: ["Reverse", "Weekly","CTF"]
#externalUrl: ""
date: 2022-06-28
draft: false
authors:
  - Jinn
---

## Microsoft ‚ù§Ô∏è Linux - 127 solves/122 points

> **Description:**
Microsoft's latest addition to the world of Open Source: a flag checker...
**Attachment file:**
[m<3l.exe](https://static.cor.team/uploads/646804dc1464496e49422efa4ca83cf62f82f080e3d62a40f2188c97740d042d/m%3C3l.exe)

Th·ª≠ check file v·ªõi DiE:

![](https://i.imgur.com/mZlQRYY.png)

Th√¨ m√¨nh ph√°t hi·ªán n√≥ l√† file elf nh∆∞ng m√† ƒëu√¥i n√≥ l√† exe:)))

Th·ª≠ setup v√† ch·∫°y tr√™n linux:

![](https://i.imgur.com/OnntyK3.png)

V√† t·∫•t nhi√™n l√† n√≥ kh√¥ng ch·∫°y tr√™n windows nh∆∞ th∆∞·ªùng ƒë∆∞·ª£c, th·ª≠ d√πng IDA ƒë·ªÉ load file:

![](https://i.imgur.com/PGlnKhC.png)

N√≥ d√πng th∆∞ vi·ªán `elf.dll`, c√°i n√†y m√¨nh c≈©ng m·ªõi nghe v√† c≈©ng kh√¥ng c√≥ nhi·ªÅu ki·∫øn th·ª©c v·ªÅ n√≥ l·∫Øm, m√¨nh c≈©ng kh√¥ng th·∫•y nhi·ªÅu t√†i li·ªáu v·ªÅ c√°i n√†y v√† hi·ªán t·∫°i ch∆∞a c·∫ßn t·ªõi n√™n t·∫°m th·ªùi b·ªè qua.

ƒêo·∫°n code ban ƒë·∫ßu kh√° l√† ng·∫Øn:

![](https://i.imgur.com/F74b9UO.png)

C∆° b·∫£n th√¨ ƒëo·∫°n n√†y n√≥ s·∫Ω l·∫•y input c·ªßa m√¨nh l∆∞u v√†o `byte_100111` sau ƒë√≥ c√≥ 1 v√≤ng l·∫∑p 18 l·∫ßn d√πng ƒë·ªÉ l·∫•y t·ª´ng k√≠ t·ª± input c·ªßa m√¨nh, sau ƒë√≥ rol 0xd bits v√† compare v·ªõi byte c√≥ s·∫µn `byte_100210`. Flow kh√° ng·∫Øn g·ªçn v√† d·ªÖ hi·ªÉu.

![](https://i.imgur.com/2CrKQ5V.png)

Sau khi ki·ªÉm tra th√¨ n√≥ c√≥ th·ªÉ in ra `Incorect :(` ho·∫∑c l√† `$Well done! Sadly, Microsoft has embraced, extended and extinguished the other half of the flag :(`...

V·ªÅ ph·∫ßn data c√≥ s·∫µn `(flag_encrypted)` th√¨ n√≥ s·∫Ω tr√¥ng nh∆∞ th·∫ø n√†y:

![](https://i.imgur.com/hJVU9u3.png)

Tuy nhi√™n theo m√¨nh th·∫•y th√¨ n√≥ l√† 36 byte ch·ª© kh√¥ng ph·∫£i l√† 18 bytes, t·∫°m th·ªùi c·ª© l·∫•y lu√¥n.

D√πng `get_bytes(0x100210,36)` ƒë·ªÉ l·∫•y 36 bytes t·ª´ IDA:

![](https://i.imgur.com/4gnDTcy.png)

V·ªõi 18 bytes ƒë·∫ßu th√¨ c√≥ th·ªÉ d·ªÖ d√†ng vi·∫øt script ƒë·ªÉ rev l·∫°i:

```python
from pwn import ror
data = b'l\xedNl\x8e\xccof\xadLN\x86lf\x85f\x0f\x8e>ci!>Uy<cjx<8e,,<p'

flag = ""
for i in data:
    flag+=chr(ror(i,13,8))
print(flag)
```

V√† ƒë√¢y l√† k·∫øt qu·∫£:

![](https://i.imgur.com/9ziwm0y.png)

C√≥ v·∫ª nh∆∞ kh√∫c sau kh√¥ng ƒë√∫ng cho l·∫Øm, th·ª≠ nh·∫≠p ch·∫°y file v√† nh·∫≠p 18 k√≠ t·ª± ƒë·∫ßu flag:

![](https://i.imgur.com/8UtZDXG.png)

Yes, n√≥ ƒë√∫ng r·ªìi, nh∆∞ng ph·∫£i c√≥ ƒëo·∫°n check ki·ªÉm tra kh√∫c sau ch·ª©?

Th·ª≠ t√¨m l·∫°i trong IDA th√¨ m√¨nh ph√°t hi·ªán ƒëo·∫°n n√†y kh√° ƒë√°ng nghi:

![](https://i.imgur.com/9SmqC6w.png)

B·∫•m 'c' ƒë·ªÉ chuy·ªÉn data v·ªÅ code th√¨ thu ƒë∆∞·ª£c ƒëo·∫°n code kh√° t∆∞∆°ng t·ª± v·ªõi ƒëo·∫°n tr√™n:

![](https://i.imgur.com/KVA4smY.png)

Flow c·ªßa ƒëo·∫°n n√†y c≈©ng t∆∞∆°ng t·ª± nh∆∞ ƒëo·∫°n tr√™n tuy nhi√™n thay v√¨ `rol` th√¨ n√≥ l·∫°i d√πng `pushf` v√† and,.. Nh∆∞ng chung quy th√¨ n√≥ c≈©ng ch·ªâ l√† m·ªôt to√°n t·ª≠ n√†o ƒë√≥, v√¨ m·ªôt l√≠ do n√†o ƒë√≥ th√¨ IDA kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c opcode n√™n n√≥ ƒë√£ kh√¥ng hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß.

M√¨nh t·ªõi ƒë√¢y m√¨nh ƒë√£ th·ª≠ ƒëo√°n xem c√°i n√†y n√≥ ƒë√£ l√†m g√¨ v·ªõi 18 bytes cu·ªëi `>ci!>Uy<cjx<8e,,<p`.V√† b·ªüi v√¨ n√≥ l√† b√†i rev kh√° ƒë∆°n gi·∫£n n√™n kh√¥ng c·∫ßn bruteforce g√¨ c·∫£, m√¨nh th·∫•y n√≥ c≈©ng kh√° d·ªÖ ƒë·ªçc n√™n c√≥ th·ªÉ l√† `+`,`-` ho·∫∑c `xor` th√¥i, c√≤n v·ªÅ to√°n h·∫°ng th√¨ m√¨nh v·∫´n s·ª≠ d·ª•ng s·ªë c≈© l√† `0xd`.

V·∫≠y n√™n l√† l√∫c d√πng ph√©p xor v·ªõi 0xd th√¨ m√¨nh ƒë√£ t√¨m ƒë∆∞·ª£c n·ªØa flag cu·ªëi:

```python
last = b'>ci!>Uy<cjx<8e,,<p'
print(xor(last,0xd)) #3nd,3Xt1ngu15h!!1}
```
K·∫øt h·ª£p 2 ph·∫ßn l·∫°i ta ƒë∆∞·ª£c flag:

Flag: ```corctf{3mbr4c3,3xt3nd,3Xt1ngu15h!!1}```

## turbocrab - 57 solves/154 points

> **Description:**
üöÄüöÄ blazinglyer faster üöÄüöÄ
SHA256 hash of the flag: `dc136f8bf4ba6cc1b3d2f35708a0b2b55cb32c2deb03bdab1e45fcd1102ae00a`
**Attachment file:**
[turbocrab](https://static.cor.team/uploads/c151963ea732b096d482896731662b367e7c50b12fc1427d0461319d01bd9a04/turbocrab)

V·ªÅ c∆° b·∫£n th√¨ n√≥ ch·ªâ l√† 1 file ELF b√¨nh th∆∞·ªùng, kh√¥ng packed v√† check flag:

![](https://i.imgur.com/OZG0cxf.png)

![](https://i.imgur.com/EiN6qAZ.png)

Load b·∫±ng IDA v√† static analysis th·ª≠:

![](https://i.imgur.com/q0VWZF4.png)

V√¨ l√† vi·∫øt b·∫±ng `rust` n√™n l√† kh√° lo·∫±ng ngo·∫±ng, v·∫≠y n√™n c√°ch nhanh nh·∫•t l√† ki·ªÉm tra trong tab `string`(t√¨m ƒëo·∫°n text "Flag is incorrect!") ƒë·ªÉ reference t·ªõi ch·ªï g·ªçi n√≥:

![](https://i.imgur.com/4gKNwGm.png)

```rust
void __cdecl turbocrab::execute_shellcode::h6984ce5848b31780(__u8_ shellcode)
{
  __u8_ v1; // rdi
  __int64 v2; // r15
  __int64 v3; // rdx
  usize v4; // [rsp+8h] [rbp-190h]
  u8 *v5; // [rsp+10h] [rbp-188h]
  usize len; // [rsp+20h] [rbp-178h]
  __int64 count; // [rsp+28h] [rbp-170h]
  core::ffi::c_void *src; // [rsp+30h] [rbp-168h]
  core::ffi::c_void *dst; // [rsp+48h] [rbp-150h]
  _BYTE v10[29]; // [rsp+63h] [rbp-135h] BYREF
  alloc::vec::Vec<u8,alloc::alloc::Global> self; // [rsp+80h] [rbp-118h] BYREF
  u8 *v12; // [rsp+98h] [rbp-100h]
  __int64 v13; // [rsp+A0h] [rbp-F8h] BYREF
  core::fmt::Arguments v14; // [rsp+A8h] [rbp-F0h] BYREF
  core::fmt::Arguments v15; // [rsp+D8h] [rbp-C0h] BYREF
  __u8_ v16; // [rsp+108h] [rbp-90h]
  core::ffi::c_void *v17; // [rsp+118h] [rbp-80h]
  __int64 *v18; // [rsp+130h] [rbp-68h]
  __int64 v19; // [rsp+138h] [rbp-60h]
  __int64 v20; // [rsp+140h] [rbp-58h]
  __int64 v21; // [rsp+148h] [rbp-50h]
  core::ffi::c_void *v22; // [rsp+150h] [rbp-48h]
  core::ffi::c_void *v23; // [rsp+158h] [rbp-40h]
  __int64 v24; // [rsp+160h] [rbp-38h]
  __int64 v25; // [rsp+168h] [rbp-30h]
  u8 *v26; // [rsp+170h] [rbp-28h]
  __int64 v27; // [rsp+178h] [rbp-20h]
  u8 *v28; // [rsp+180h] [rbp-18h]

  v16 = shellcode;
  v25 = 0LL;
  dst = (core::ffi::c_void *)mmap(0LL, shellcode.length, 3, 33, -1, 0LL);
  v17 = dst;
  qmemcpy(v10, "R^CRIWJM<6.[5I.G`.C3G3CB5_V?P", sizeof(v10));
  alloc::vec::from_elem::hba0d51ad3cb1207d(&self, 0, 0x4000uLL);
  v26 = alloc::vec::Vec$LT$T$C$A$GT$::as_ptr::h0252951c7d91d004(&self);
  v27 = 49602LL;
  v28 = v26 + 49602;
  v12 = v26 + 49602;
  src = (core::ffi::c_void *)core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::as_ptr::h869fdf96852d8c48(shellcode);
  count = core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::len::h00af0a2d7a9c0658(shellcode);
  v22 = dst;
  v23 = src;
  v24 = count;
  core::intrinsics::copy::h46e3e522e297e890(src, dst, count);
  len = core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::len::h00af0a2d7a9c0658(shellcode);
  mprotect(dst, len, 5);
  v13 = v20;
  v18 = &v13;
  v1.data_ptr = v10;
  v1.length = 29LL;
  v5 = core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::as_ptr::h869fdf96852d8c48(v1);
  v1.data_ptr = v10;
  v1.length = 29LL;
  v4 = core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::len::h00af0a2d7a9c0658(v1);
  v2 = (__int64)v12;
  v13 = ((__int64 (__fastcall *)(_BYTE *, __int64, __int64, core::ffi::c_void *, u8 *, usize))dst)(
          v10,
          29LL,
          v3,
          dst,
          v5,
          v4);
  v12 = (u8 *)v2;
  v19 = v13;
  v21 = v13;
  if ( v13 == 1 )
    core::fmt::Arguments::new_v1::h610d7aa66ccb1a0c(
      &v14,
      (___str_)__PAIR128__(1LL, &stru_174F78),
      (__core::fmt::ArgumentV1_)(unsigned __int64)&stru_10B240);
  else
    core::fmt::Arguments::new_v1::h610d7aa66ccb1a0c(
      &v15,
      (___str_)__PAIR128__(1LL, &stru_174F68),
      (__core::fmt::ArgumentV1_)(unsigned __int64)&stru_10B240);
  std::io::stdio::_print::hccc6c4adfff98fee();
  core::ptr::drop_in_place$LT$alloc..vec..Vec$LT$u8$GT$$GT$::h34608ea8b4b90afb(&self);
}
```

T·ªõi ƒë√¢y c√≥ 1 ƒëi·ªÉm ƒë√°ng ch√∫ √Ω l√† 

```qmemcpy(v10, "R^CRIWJM<6.[5I.G`.C3G3CB5_V?P", sizeof(v10));``` 

nh√¨n kh√° gi·ªëng v·ªõi ƒëo·∫°n flag encrypted v·∫≠y.

Ti·∫øp theo l√† shellcode ƒë∆∞·ª£c s·ª≠ d·ª•ng kh√° nhi·ªÅu

![](https://i.imgur.com/PnQWrWl.png)

V√† ngo√†i ra c√≤n bi·∫øn `v13` d√πng ƒë·ªÉ r·∫Ω nh√°nh ch∆∞∆°ng tr√¨nh Xu·∫•t ra Correct! hay Incorrect!:

![](https://i.imgur.com/wNL0YcG.png)

V√† n√≥ ƒë∆∞·ª£c tr·∫£ v·ªÅ sau khi g·ªçi "dst".

T·ªõi ƒë√¢y r·∫•t c√≥ th·ªÉ dst n√†y s·∫Ω ch·ª©a shellcode l√† l√† lu·ªìn th·ª±c thi ch√≠nh c·ªßa ch∆∞∆°ng tr√¨nh, setup ngay m√°y ·∫£o, ƒë·∫∑t breakpoint v√† debug file th√¥i!..

![](https://i.imgur.com/ADeZrti.png)

Sau khi t·ªõi breakpoint, nh·∫•n `f7` ƒë·ªÉ step into
 xem b√™n trong "dst" c≈©ng nh∆∞ l√† shellcode c√≥ g√¨:
 
![](https://i.imgur.com/qJaxteW.png)

Sau khi ch·∫°y t·ªõi `call    near ptr unk_7F8C04CC62B2`, n√≥ b·∫Øt m√¨nh nh·∫≠p input, th·ª≠ nh·∫≠p "abcdefgh" cho d·ªÖ quan s√°t

T·ªõi ƒë√¢y c√≥ th·ªÉ th·∫•y ƒë∆∞·ª£c ƒëo·∫°n flag encrypted c≈©ng ƒë∆∞·ª£c load v√†o, v√† c·∫£ input c·ªßa m√¨nh n·ªØa:

![](https://i.imgur.com/RPrd0sc.png)

![](https://i.imgur.com/eAn2sJf.png)

Ti·∫øp t·ª•c trace v√† debug, m√¨nh bi·∫øt ƒë∆∞·ª£c flow nh∆∞ sau: N√≥ l·∫•y t·ª´ng k√≠ t·ª± c·ªßa input m√¨nh `c`, sau ƒë√≥:
`c^0x13 - 0x1e` v√† compare v·ªõi l·∫°i t·ª´ng k√≠ t·ª± c·ªßa flag encrypted.

![](https://i.imgur.com/4aGcU2P.png)

T·ªõi ƒë√¢y th√¨ m√¨nh m·ª´ng th·∫ßm, ch·ªâ c·∫ßn vi·∫øt scipt rev l·∫°i l√† ra. Sau ƒë√≥ m√¨nh ƒë√£ d√πng python v√† code th·ª≠:

```python
fl = b"R^CRIWJM<6.[5I.G`.C3G3CB5_V?P"
s = ""
j = 0
for i in fl:
    s+=chr((i+0x1E)^0x13)
print(s) #corctf{xIG_j@t_vm_rBvBrs@ngN}
```

C√≥ l·∫Ω ƒë√£ g·∫ßn ƒë√∫ng nh∆∞ng nh√¨n kh√¥ng gi·ªëng flag cho l·∫Øm. T·ªõi ƒë√¢y m√¨nh ƒë√£ th·ª≠ submit v√† t·∫•t nhi√™n n√≥ sai.

Sau ƒë√≥ m√¨nh ƒë√£ th·ª≠ rev kƒ© l·∫° ch∆∞∆°ng tr√¨nh th√¨ th·∫•y m·ªôt v√†i chi ti·∫øt b·ªã thi·∫øu nh∆∞ng khi th·ª≠ nh·∫≠p flag v√†o ch∆∞∆°ng tr√¨nh th√¨ n√≥ v·∫´n ƒë√∫ng => n√≥ kh√¥ng d√πng t·ªõi nh·ªØng kh√∫c ƒë√≥, ph·∫ßn rev file coi nh∆∞ xong.

![](https://i.imgur.com/81RDTMu.png)

Tuy nhi√™n v·∫´n c√≤n 1 thi·∫øu s√≥t l√† ƒë·ªÅ cho ch√∫ng ta sha256 flag, v·∫≠y l√† c√≥ th·ª© ƒë·ªÉ ki·ªÉm ch·ª©ng, c√≤n v·ªÅ flag th√¨ c√≥ th·ªÉ d·ªÖ d√†ng nh√¨n th·∫•y m·ªôt s·ªë k√≠ t·ª± nh√¨n kh√° l√† l·∫°, m·ªôt s·ªë c√≤n l·∫°i h·∫ßu nh∆∞ ch·∫Øc ch·∫Øn ƒë√∫ng:

```corctf{xIG_j@t_vm_rBvBrs@ngN}```

D·ª±a theo flag c·ªßa b√†i tr∆∞·ªõc th√¨ c√≥ h∆∞·ªõng suy nghƒ© l√† c√≥ th·ªÉ nh·ªØng k√≠ t·ª± uppercase v√† symbol coi nh∆∞ sai, c√≤n t·ª´ cu·ªëi trong flag c√≥ th·ªÉ d·ªÖ ƒëo√°n l√† reversing

=> B l√† ch·ªØ i, ho·∫∑c c≈©ng c√≥ th·ªÉ l√† s·ªë 1, ho·∫∑c l√† I, th√¥i c·ª© ƒë∆∞a v√†o cho ch·∫Øc ƒÉn, t∆∞∆°ng t·ª± v·ªõi @.

C√≤n I,G,N t·∫°m th·ªùi ch∆∞a bi·∫øt n√™n l√† c·ª© bruteforce, m√¨nh ƒë√£ vi·∫øt th·ª≠ script ƒë·ªÉ brute:

```python
from pwn import *
fl = b"R^CRIWJM<6.[5I.G`.C3G3CB5_V?P"
s = ""
j = 0
for i in fl:
    s+=chr((i+0x1E)^0x13)
print(s)
hashflag = "dc136f8bf4ba6cc1b3d2f35708a0b2b55cb32c2deb03bdab1e45fcd1102ae00a"

xflag = "corctf{xIG_j@t_vm_rBvBrs@ngN}"
for I in range(0xf7):
    for G in range(0xf7):
        for a in ['1','i','I']:
            for B in ['3','e','E',]:
                for N in range(0xf7):
                    temp = xflag.replace('I',chr(I)).replace('G',chr(G)).replace('@',a).replace('B',B).replace('N',chr(N))
                    hashed_string = hashlib.sha256(temp.encode('utf-8')).hexdigest()
                    if hashed_string==hashflag:
                        print(temp)
                        exit(0)
            #corctf{x86_j1t_vm_r3v3rs1ng?}
```

Flag: ```corctf{x86_j1t_vm_r3v3rs1ng?}```

## msfrob - 44 solves/170 points

> **Description:**
6b0a444558474b460a5a58454d584b470a5f5943444d0a444558474b460a4d464348490a4c5f44495e4345445904
**Attachment file:**
[msfrob](https://static.cor.team/uploads/48fcb317ca7280353ab06e4867f510740046ad9e65eaa9a3fc5e97095fbbf9d7/msfrob)

Th·ª≠ ki·ªÉm tra b·∫±ng DiE:

![](https://i.imgur.com/jQ0C2KG.png)

V√¨ ban ƒë·∫ßu ch·∫°y kh√¥ng ƒë∆∞·ª£c n√™n load b·∫±ng IDA ƒë·ªÉ ph√¢n t√≠ch th·ª≠:

![](https://i.imgur.com/7Y3Qfdp.png)

Th√¨ ban ƒë·∫ßu flow kh√° d·ªÖ hi·ªÉu n√≥ s·∫Ω nh·∫≠n input th√¥ng qua agrv v√† x·ª≠ l√≠ qua v√≤ng l·∫∑p 20 l·∫ßn, tuy nhi√™n, c√°c h√†m ·ªü v√≤ng l·∫∑p n√†y kh√¥ng c√≥ t√™n v√† c≈©ng kh√¥ng c√≥ code, n√™n m√¨nh ƒëo√°n n√≥ l√† l·∫•y t·ª´ th∆∞ vi·ªán ra m√¨nh. V·∫≠y l√† tr∆∞·ªõc khi ch·∫°y th√¨ m√¨nh kh√¥ng bi·∫øt g√¨ v·ªÅ n√≥

ƒê·ªëi v·ªõi m√¨nh th√¨ b√†i n√†y l√† b√†i khi·∫øn m√¨nh m·∫•t th·ªùi gian nh·∫•t =))) Kh√¥ng ph·∫£i v√¨ b√†i kh√≥ m√† l√† fix c√°i ubuntu c·ªßa m√¨nh v√¨ khi ch·∫°y file n√≥ s·∫Ω nh∆∞ th·∫ø n√†y:

![](https://i.imgur.com/gSy3qho.png)

Ho·∫∑c l√† nh∆∞ th·∫ø n√†y:

![](https://i.imgur.com/C4dFDZj.png)

Th√¨ 2 h√¨nh ·∫£nh l√† 2 phi√™n b·∫£n h·ªá ƒëi·ªÅu h√†nh kh√°c nhau (`22.04` v√† `18.04`, m√¨nh c≈©ng ƒë√£ th·ª≠ v·ªõi `20.04`nh∆∞ng c≈©ng t∆∞∆°ng t·ª±), m√¨nh x√†i WSL n√™n c≈©ng hay c√≥ l·ªói v·∫∑t. M√¨nh ƒë√£ th·ª≠ t√¨m c√°ch fix tr√™n m·∫°ng r·∫•t nhi·ªÅu nh∆∞ng n√≥ r·∫•t nh·ª©c ƒë·∫ßu v√† l√†m theo c≈©ng kh√¥ng fix ƒë∆∞·ª£c.

T·ªõi ƒë√¢y c√≤n c√°ch duy nh·∫•t l√† m√¨nh c√†i l·∫°i 1 ubuntu ho√†n to√†n m·ªõi, r·ªìi t·ª´ ƒë√≥ bi·∫øt m√¨nh thi·∫øu c√°i g√¨ th√¨ c√†i c√°i ƒë√≥.

C·ª• th·ªÉ th√¨ sau khi c√†i [Ubuntu](https://ubuntu.com/download/desktop), v√† n√≥ b√°o m√¨nh thi·∫øu th∆∞ vi·ªán `libcrypto.so.1.1`, qua 1 th·ªùi gian d√†i t√¨m hi·ªÉu th√¨ m√¨nh t√¨m ƒë∆∞·ª£c c√°ch fix l√† c√†i l·∫°i to√†n b·ªô openssl theo phi√™n b·∫£n 1.1 nh∆∞ [link n√†y](https://fedingo.com/how-to-install-openssl-in-ubuntu/).

Sau khi fix xong, ch·∫°y fix th√¨ n√≥ s·∫Ω tr√¥ng nh∆∞ th·∫ø n√†y:

![](https://i.imgur.com/au4pQPB.png)

Nice, gi·ªù th√¨ setup debug ƒë·ªÉ xem n√≥ l√†m g√¨ th√¥i.

Tr∆∞·ªõc khi v√†o v√≤ng l·∫∑p th√¨ n√≥ ƒëi qua 2 h√†m, nh∆∞ng c√≥ v·∫ª 2 h√†m n√†y kh√¥ng quan tr·ªçng l·∫Øm.

![](https://i.imgur.com/rgwy6Mq.png)

![](https://i.imgur.com/m97AUgR.png)

T·ªõi h√†m ƒë·∫ßu ti√™n, m√¨nh th·ª≠ click ƒë√∫p v√† trace xem n√≥ l√† g√¨ th√¨ ƒë∆∞·ª£c k·∫øt qu·∫£ nh∆∞ n√†y:

![](https://i.imgur.com/YG3Yu9W.png)

Th√¨ n√≥ l√† deflate init, search th·ª≠ `deflate` tr√™n m·∫°ng th√¨ m√¨nh bi·∫øt ƒë∆∞·ª£c n√≥ l√† compress nh∆∞ng thay v√¨ tr√™n file (zip,tar) th√¨ l√† tr√™n data (compress data).

Ti·∫øp t·ª•c l√†m t∆∞∆°ng t·ª± v·ªõi c√°c h√†m c√≤n l·∫°i, m√¨nh ƒë√£ rename l·∫°i g·∫ßn nh∆∞ to√†n b·ªô v√† ƒë∆∞·ª£c ƒëo·∫°n code nh∆∞ sau:

```c
__int64 __fastcall sub_55A613A3B4E1(__int64 input, __int64 a2)
{
  __int64 aes; // rax
  __int64 result; // rax
  int len_out; // [rsp+1Ch] [rbp-894h] BYREF
  int blocksize; // [rsp+20h] [rbp-890h] BYREF
  int i; // [rsp+24h] [rbp-88Ch]
  __int64 CipherCTX; // [rsp+28h] [rbp-888h]
  __int64 *v8; // [rsp+30h] [rbp-880h] BYREF
  int v9; // [rsp+38h] [rbp-878h]
  __int64 *v10; // [rsp+48h] [rbp-868h]
  int v11; // [rsp+50h] [rbp-860h]
  __int64 len_in; // [rsp+58h] [rbp-858h]
  __int64 v13; // [rsp+70h] [rbp-840h]
  __int64 v14; // [rsp+78h] [rbp-838h]
  __int64 v15; // [rsp+80h] [rbp-830h]
  __int64 buf_out[128]; // [rsp+A0h] [rbp-810h] BYREF
  __int64 buf_in[2]; // [rsp+4A0h] [rbp-410h] BYREF
  char v18[1016]; // [rsp+4B0h] [rbp-400h] BYREF
  unsigned __int64 v19; // [rsp+8A8h] [rbp-8h]

  v19 = __readfsqword(0x28u);
  memset(buf_out, 0, sizeof(buf_out));
  buf_in[0] = 0LL;
  buf_in[1] = 0LL;
  memset(v18, 0, 0x3F0uLL);
  len_out = sub_55A613A3B080(input, a2, v18);
  sub_55A613A3B120();
  for ( i = 0; i <= 19; ++i )
  {
    v13 = 0LL;
    v14 = 0LL;
    v15 = 0LL;
    v9 = len_out;
    v8 = buf_out;
    v11 = 1024;
    v10 = buf_in;
    Deflate_init((__int64)&v8, 0xFFFFFFFFLL, (__int64)"1.2.12", 112LL);
    Deflate(&v8, 4LL);
    Deflate_end(&v8);
    CipherCTX = CIPHER_CTX_new();
    aes = Aes_256_cbc();
    Encrypt_init(CipherCTX, aes, 0LL, (__int64)&key, (__int64)&iv);

    EncryptUpdate(CipherCTX, buf_out, &len_out, buf_in, (unsigned int)len_in);
    EncryptFinal_ex(CipherCTX, (char *)buf_out + len_out, &blocksize);
    CIPHER_CTX_free(CipherCTX);
    len_out += blocksize;
  }
  if ( (unsigned int)sub_55A613A3B0F0(buf_out, &byte, 352LL) )
    sub_55A613A3B040("Incorrect :msfrog:");
  else
    sub_55A613A3B040("Correct :msfrogcircle:");
  result = v19 - __readfsqword(0x28u);
  if ( result )
    return sub_55A613A3B0E0();
  return result;
}
```

Gi·∫£i th√≠ch: Sau nhi·ªÅu l·∫ßn debug th√¨ m√¨nh bi·∫øt ƒë∆∞·ª£c `input` c·ªßa m√¨nh s·∫Ω ƒë∆∞·ª£c deflate (compress) v√† 16bytes ƒë·∫ßu c·ªßa ƒëo·∫°n compressed_data s·∫Ω ƒë∆∞·ª£c encrypt b·∫±ng AES_CBC (v·ªõi key,iv bi·∫øt tr∆∞·ªõc, `EncryptUpdate()`) v√† h√†m `Encrypt_final_ex()` s·∫Ω encrypt ƒëo·∫°n c√≤n l·∫°i c·ªßa compressed_data v√† l∆∞u v√†o ngay sau ƒëo·∫°n ƒë·∫ßu ti√™n.

Nh∆∞ v·∫≠y v·ªõi compressed_data c√≥ `16 < lenght < 32` th√¨ out put ƒë∆∞·ª£c ghi tr√™n buf_out s·∫Ω c√≥ lenght b·∫±ng 32, ·ªü v√≤ng l·∫∑p ti·∫øp theo, n√≥ s·∫Ω l·∫•y 32 byte n√†y compress v√† l·∫∑p l·∫°i c√°c b∆∞·ªõc trong v√≤ng l·∫∑p, buf_out l·∫ßn n√†y s·∫Ω c√≥ length l√† 48... cho t·ªõi khi length = 352 (l·∫∑p ƒë·ªß 20 l·∫ßn) v√† tho√°t kh·ªèi v√≤ng l·∫∑p, nh∆∞ v·∫≠y n√≥ s·∫Ω ƒë∆∞·ª£c m√¥ ph·ªèng nh∆∞ sau:

```python

from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
import zlib

byte = b'L\xef4\xfa\xd1%EK\xe7\xad\x99\xc4\xb1\xd7\xf6,[\xf3\x13\xbf\xcc\x03\x1d\x16\x81\xdbP8\xa8\xb6\xdd \x90*n\xa2\xef\xfek\x8f\xdb\x80opt\xeb}6\xe4\xdc\x87\xf3 \xeb\xe5\x0f>(5X\xad\x07\xd2=\xd8]A5^OA\x9b\x91\x85\xe1\\\x18\xb8\xf6Z\xdf\x0851\x04\xd2\xe0Dd\xfc\x06\xc6\xd6[\x98 O\x1c\x1e\xb8 \xd5\x9e\xda\x81\xd66[U`\xa8,\xf2\xdaW\x92\xc9\xe0\x14\xf0CK.\x11\xd3pg\xa8U\x08}\xc7vOw\xe8\xbe\xf3\x19\x04\x84\xb2\xa0 \xdcL\xd2\xc8\x94\x17\x9buOx55\xe6bt-\x0c\xa84\xf1\x90\xa9\xfdY\xd4\xf8$\xb9;\x94\xbdy\xc7x\xb9V\xc1\xe3\xb6.\x17:2\xf9NG\xf9\t\xc4\xe8\xfaISj\x0b\xb96\x0b+\\\xc9\xf39c\xb3\xd1\xacpl\xf1FB\xbc\x0b\x91:d\x95w\xec$\x01d\xd2\x98\xe1\xbf8\x17\xd4\xd09\x16\x13\x1d4\xa4\x1a\xfa3_\x88!\xd5\\N\xbf3\x9d\xe1*\xccG\x15\x03\x9d\xa6\x856-m1\x01=\x95\x08\xdcr\xd3\xf6\xf7e\xb7\xc0\x95]\xf4\xc9\xa7\xfa\xdc\xefQ6\xc1\x1d\xe6\x08\xeb\x8a\xec]\xc9Z=\xd3\x9a\xa6\xad(\x99$\x88\x92@-\xab\x12Y\xf8\x84G\xb2\xb9H\xf7\x8f\x1e2d\xba$\xd2=\xf3\xc4\x84\xbd\xd2\xe1\x01\x07\xa1v\x18E\x1eT\x91\x93\x11nAT~@\xe7\x02'
key = b'\xd4\xf5\xd9g\x15/w\x7fl|Fs\xf6\xf0\x92\xf0wP;0\x0c\x87\x8a\r\x9c\x1dr\xa2eF\xc8\xdc'

# cipher explain
inp = b'corctf{abcdefgh}'
buf_out = inp
for i in range(20):
    text = zlib.compress(buf_out)
    cipher = AES.new(key, AES.MODE_CBC,iv= (b'\x00'*16))
    first = cipher.encrypt(text[:16])
    final = cipher.encrypt(pad(text[16:],16))
    buf_out = first + final 
print(buf_out)

```

Nh∆∞ v·∫≠y, c√≥ th·ªÉ d·ªÖ d√†ng rev algo n√†y l·∫°i nh∆∞ sau v√† l·∫•y flag:

```python
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
import zlib

byte = b'L\xef4\xfa\xd1%EK\xe7\xad\x99\xc4\xb1\xd7\xf6,[\xf3\x13\xbf\xcc\x03\x1d\x16\x81\xdbP8\xa8\xb6\xdd \x90*n\xa2\xef\xfek\x8f\xdb\x80opt\xeb}6\xe4\xdc\x87\xf3 \xeb\xe5\x0f>(5X\xad\x07\xd2=\xd8]A5^OA\x9b\x91\x85\xe1\\\x18\xb8\xf6Z\xdf\x0851\x04\xd2\xe0Dd\xfc\x06\xc6\xd6[\x98 O\x1c\x1e\xb8 \xd5\x9e\xda\x81\xd66[U`\xa8,\xf2\xdaW\x92\xc9\xe0\x14\xf0CK.\x11\xd3pg\xa8U\x08}\xc7vOw\xe8\xbe\xf3\x19\x04\x84\xb2\xa0 \xdcL\xd2\xc8\x94\x17\x9buOx55\xe6bt-\x0c\xa84\xf1\x90\xa9\xfdY\xd4\xf8$\xb9;\x94\xbdy\xc7x\xb9V\xc1\xe3\xb6.\x17:2\xf9NG\xf9\t\xc4\xe8\xfaISj\x0b\xb96\x0b+\\\xc9\xf39c\xb3\xd1\xacpl\xf1FB\xbc\x0b\x91:d\x95w\xec$\x01d\xd2\x98\xe1\xbf8\x17\xd4\xd09\x16\x13\x1d4\xa4\x1a\xfa3_\x88!\xd5\\N\xbf3\x9d\xe1*\xccG\x15\x03\x9d\xa6\x856-m1\x01=\x95\x08\xdcr\xd3\xf6\xf7e\xb7\xc0\x95]\xf4\xc9\xa7\xfa\xdc\xefQ6\xc1\x1d\xe6\x08\xeb\x8a\xec]\xc9Z=\xd3\x9a\xa6\xad(\x99$\x88\x92@-\xab\x12Y\xf8\x84G\xb2\xb9H\xf7\x8f\x1e2d\xba$\xd2=\xf3\xc4\x84\xbd\xd2\xe1\x01\x07\xa1v\x18E\x1eT\x91\x93\x11nAT~@\xe7\x02'
key = b'\xd4\xf5\xd9g\x15/w\x7fl|Fs\xf6\xf0\x92\xf0wP;0\x0c\x87\x8a\r\x9c\x1dr\xa2eF\xc8\xdc'

# cipher explain
inp = b'corctf{abcdefgh}'
buf_out = inp
for i in range(20):
    text = zlib.compress(buf_out)
    cipher = AES.new(key, AES.MODE_CBC,iv= (b'\x00'*16))
    first = cipher.encrypt(text[:16])
    final = cipher.encrypt(pad(text[16:],16))
    buf_out = first + final 
print(buf_out)
#rev
p1 = byte[:16]
p2 = byte[16:]
# first = p1
# final = p2
for i in range(20):
    cipher = AES.new(key, AES.MODE_CBC,iv= (b'\x00'*16))
    first = cipher.decrypt(p1)
    final = cipher.decrypt(p2)
    comp_text = first+final
    
    decomp_text = zlib.decompress(comp_text)
    p1 = decomp_text[:16]
    p2 = decomp_text[16:]
    print(decomp_text)
```
![](https://i.imgur.com/nGz6WjK.png)

Flag: ```corctf{why_w0u1d_4ny0n3_us3_m3mfr0b??}```


## hackermans dungeon - 8 solves / 362 points

> **Description:**
Hackerman told us he cannot be hacked. Can you hack hackerman?
**Attachment file:**
[hackermans_dungeon.exe](https://static.cor.team/uploads/42df4d989f27b7bfbd1c66dcc329644bca70a48c717fdb6e65b3ca53c228fd4f/hackermans_dungeon.exe)

Ri√™ng b√†i n√†y th√¨ m√¨nh l√†m ra sau khi gi·∫£i v·ª´a k·∫øt th√∫c v√¨ m√¨nh bi·∫øt m√¨nh b·ªã bjp ·∫°=)) n√™n l√† s·∫µn vi·∫øt lu√¥n ƒë·ªÉ ƒë√¢y cho m·ªçi ng∆∞·ªùi c√≥ nhu c·∫ßu tham kh·∫£o ·∫°.

M·ªü b·∫±ng IDA ƒë·ªÉ ph√¢n t√≠ch th√¨ c√≥ 1 ƒëi·ªÅu l√† n√≥ kh√¥ng hi·ªán c√°c t√™n h√†m v√† kh√¥ng bi·∫øt n√≥ l√†m g√¨, tuy nhi√™n m√¨nh c√≥ s·ª≠ d·ª•ng plug-in `findcrypt` v√† debug nhi·ªÅu l·∫ßn th√¨ ƒë√¢y l√† th·ª© m√† m√¨nh c√≥ ƒë∆∞·ª£c:

![](https://i.imgur.com/tLmbpaX.png)

V√† th√™m 1 v√†i ƒëi·ªÅu l√† m√¨nh bi·∫øt tr∆∞·ªõc SHA256 l√∫c m√† n√≥ compare v·ªõi Buf2. C√≤n username th√¨ kh√¥ng l√†m g√¨ nhi·ªÅu

Ban ƒë·∫ßu v·ªõi flow n√†y, m√¨nh ƒë√£ th·ª≠ 1 c√°ch ƒë√≥ l√† t·∫°i l√∫c compare sha256 v·ªõi buf2, m√¨nh ƒë√£ patch buf2 = sha256 ƒë·ªÅ cho v√† pass qua ƒë∆∞·ª£c ƒëo·∫°n check ƒë√≥, tuy nhi√™n, debug m·ªôt h·ªìi m√¨nh v·∫´n kh√¥ng th·∫•y flag ƒë√¢u.

Th·ª≠ l·∫°i nhi·ªÅu l·∫ßn v√† t√¨m hi·ªÉu kƒ© c√°c thu·∫≠t to√°n tr√™n th√¨ m√¨nh bi·∫øt ƒë∆∞·ª£c n√≥ d√πng c√°c encryption nh∆∞ tr√™n nh∆∞ng c≈©ng kh√¥ng gi√∫p √≠t g√¨ nhi·ªÅu, m√¨nh ch·ªâ bi·∫øt ƒë∆∞·ª£c l√†, sau khi l√†m g√¨ ƒë√≥ v·ªõi password th√¨ n√≥ d√πng ƒëo·∫°n ƒë√≥ ƒë·ªÉ xor v·ªõi `byte_1400740`(length  = 35) va r·∫•t c√≥ th·ªÉ ƒë√¢y ch√≠nh l√† flag. Nh∆∞ng t·∫°i sau v·∫´n kh√¥ng ƒë√∫ng nh·ªâ?

Sau gi·∫£i th√¨ m√¨nh c√≥ th·ª≠ tham kh·∫£o m·∫•y anh th√¨ c√°ch duy nh·∫•t l√† crack c√°i sha256 ƒë√≥=))) m√† ban ƒë·∫ßu minh qu√™n m·∫•t m·ªôt ƒëi·ªÅu l√†, ƒë√≥ ch·ªâ l√† password ch·ª© kh√¥ng ph·∫£i flag, c√≤n passwordlist th√¨ tr√™n m·∫°ng ƒë·∫ßy =)) sax

Th√¥i th√¨ ng·∫≠m ng√πi vi·∫øt script crack pass th√¥i:

[rockyou.txt](https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt)

```python

from hashlib import sha256
from itertools import count
from pwn import *
from Crypto.Cipher import Salsa20,ChaCha20

from pwn import *
pwhash = b"\x9c\x00\xf1\xaccb\x16\xe24/d\xae;\x82\xe3\xc0'I\xa6\x9c5\xdf\x8c\x03UMU\xc1\x01\x86\x9dG"
# username = b'CORnwallis'
#[patch_byte(0x0B010D3F7F0+i,d) for i,d in zip(range(35),b"\x9c\x00\xf1\xaccb\x16\xe24/d\xae;\x82\xe3\xc0'I\xa6\x9c5\xdf\x8c\x03UMU\xc1\x01\x86\x9dG")]
# byte = b':\xab5\x81\xd5_V\xb0\xce\xe5\xf5\x16M\xb3\x8d-x#\xd0\x1c\x00\xc1\xec\x07\x19\x022\x91J\xb4c\xcc\xed\xd9\x08'

def SUScrypt(password):
    password = [i for i in password]
    lenpw = len(password)
    j = 0
    k = 1
    while j<lenpw:
        password[j]+=1
        password[j] = (~((password[k % lenpw] ^ password[j]) + 98))&0xff;
        k+=1
        j+=1
    return b"".join([i.to_bytes(1,'big') for i in password])
f = open('rockyou.txt','rb').readlines()
for pw in f:
    # print(sha256(SUScrypt(pw[:-1])).digest())
    if sha256(SUScrypt(pw[:-1])).digest()==pwhash:
        print(pw)
        break
```
√Ä m√† trong l√∫c ki·ªÉm tra h√†m SUScrypt c√≥ ho·∫°t ƒë·ªông ƒë√∫ng hay kh√¥ng th√¨ m√¨nh ƒë√£ th·ª≠ debug nhi·ªÅu l·∫ßn, m√† m√¨nh th·∫•y l√† m·∫∑c d√π c√≥ ƒëo·∫°n md5 nh∆∞ng n√≥ kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn c√°i ƒëo·∫°n Buf2 =)), v·∫≠y l√† do n√≥ t√°c ƒë·ªông t·ªõi bi·∫øn kh√°c m√† khi m√¨nh patch buf2 v·∫´n kh√¥ng ra flag. V·∫≠y n√™n trong l√∫c vi·∫øt script m√¨nh kh√¥ng d√πng md5

Ch·∫°y x√≠u th√¨ c√≥ ƒë∆∞·ª£c password: `canthackmehackers`

Nh·∫≠p pass v√†o, ƒë·∫∑t breakpoint, bypass anti-debug v√† check th·ª≠ `byte_1400740`:

![](https://i.imgur.com/Mrvkgt6.png)

ƒê·ªÉ bypass th√¨ t·∫°i jnz ch·ªânh cho ZeroFlag = 1, c√≤n ch·ªï jnb th√¨ ch·ªânh CarryFlag = 1 l√† ƒë∆∞·ª£c

![](https://i.imgur.com/wB4DMHZ.png)

![](https://i.imgur.com/Hu6L9vJ.png)

Flag: `corctf{d1d_y0u_h4ck_m3_h4ck3rm4n?}`

Done!