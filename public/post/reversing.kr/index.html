<!doctype html>
<html
  lang="en-us" 
  
    data-theme-mode="true"
  
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  reversing.kr | Le Phu Duc
</title>
<meta
  name="description"
  content="Write up for rev problem in reversing.kr"
/>



  <script>
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "true");
</script>


  
<script src="https://www.googletagmanager.com/gtag/js?id=true"></script>
<script data-pjax>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }

  gtag('js', new Date());

  gtag('config', 'true');
</script>








<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"All articles in this blog are licensed under BY-NC-SA unless otherwise stated. Please indicate the source when reprinting!\",\"count\":50,\"enable\":false},\"fail\":\"Failed to copy (ﾟ⊿ﾟ)ﾂ\",\"success\":\"Copied\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":\"This article was last updated on {time}. Please note that the content may have changed.\"}}");
</script>











  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  


<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7cUbuntu%20Mono:400,400italic,700,700italic%7cSource%20Code%20Pro:400,400italic,700,700italic%7cJetBrains%20Mono:400,400italic,700,700italic&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7cUbuntu%20Mono:400,400italic,700,700italic%7cSource%20Code%20Pro:400,400italic,700,700italic%7cJetBrains%20Mono:400,400italic,700,700italic&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />








<link rel="shortcut icon" href="/favicon/favicon.ico">







 <link rel="stylesheet" href="/css/main.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />








  <link rel="stylesheet" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" />



  </head>
  <body>
    

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe632;
          
        </div>
        <a class="main-nav-link" href="/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe628;
          
        </div>
        <a class="main-nav-link" href="/about">About</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe604;
          
        </div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe621;
          
        </div>
        <a class="main-nav-link" href="/achievements">Achievements</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"></a>
    
  </nav>
</div>
<header id="header">
  
    <picture>
      
        
          <source media="(max-width: 479px)" srcset="/images/newjeans3.jpg">
        
          <source media="(max-width: 799px)" srcset="/images/newjeans3.jpg">
        
          <source media="(min-width: 800px)" srcset="/images/newjeans3.jpg">
        
        <img fetchpriority="high" src="/images/newjeans3.jpg" alt="reversing.kr">
      
    </picture>
    
      <img src="" alt="reversing.kr" style="visibility: hidden;">
    
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">reversing.kr</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <div id="content"
          class="sidebar-left"
            >
          <aside id="sidebar">
  
    <div id="aplayer" theme="var(--color-link)" data-aos="fade-up"></div>
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#easy-crack---100pts">Easy Crack - 100pts</a></li>
    <li><a href="#easy-keygen---100pts">Easy Keygen - 100pts</a></li>
    <li><a href="#easy-unpack---100pts">Easy Unpack - 100pts</a></li>
    <li><a href="#easy-elf---100pts">Easy ELF - 100pts</a></li>
    <li><a href="#replace---150pts">Replace - 150pts</a></li>
    <li><a href="#imageprc---120pts">ImagePrc - 120pts</a></li>
    <li><a href="#music-player---150pts">Music Player - 150pts</a></li>
    <li><a href="#cshop---120pts">CSHOP - 120pts</a></li>
    <li><a href="#position---160pts">Position - 160pts</a></li>
    <li><a href="#direct3d-fps---140pts">Direct3D FPS - 140pts</a></li>
    <li><a href="#multiplicative---170pts">Multiplicative - 170pts</a></li>
    <li><a href="#ransomware---120pts">ransomware - 120pts</a></li>
    <li><a href="#hateintel---150pts">HateIntel - 150pts</a></li>
    <li><a href="#x64-lotto---140pts">x64 Lotto - 140pts</a></li>
    <li><a href="#autohotkey1---130pts">AutoHotKey1 - 130pts</a></li>
    <li><a href="#csharp---160pts">CSHARP - 160pts</a></li>
    <li><a href="#twist1---190pts">Twist1 - 190pts</a></li>
    <li><a href="#pepassword---150pts">PEpassword - 150pts</a>
      <ul>
        <li><a href="#originalexe">Original.exe:</a></li>
        <li><a href="#packedexe">Packed.exe:</a></li>
      </ul>
    </li>
    <li><a href="#windowkernel---220pts">WindowKernel - 220pts</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#approach">Approach</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="/avatar/shiba.jpg"
    data-sizes="auto"
    alt="Le Phu Duc"
    class="lazyload"
  />
  <div class="sidebar-author-name">Le Phu Duc</div>
  <div class="sidebar-description">a.k.a Jinn</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">17</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      1
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">6</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-discord sidebar-social-icon">
      <a
        href="https://discordapp.com/users/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-facebook sidebar-social-icon">
      <a
        href="https://www.facebook.com/lephuduc0309"
        itemprop="url"
        target="_blank"
        aria-label="facebook"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-instagram sidebar-social-icon">
      <a
        href="https://www.instagram.com/le.phuduc"
        itemprop="url"
        target="_blank"
        aria-label="instagram"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-twitter sidebar-social-icon">
      <a
        href="https://twitter.com/lephuduck"
        itemprop="url"
        target="_blank"
        aria-label="twitter"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe628;
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe604;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/achievements"
        aria-label="Achievements"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">Achievements</div>
    </div>
  
</div>

        </div>
      

      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  <div class="sidebar-widget">
    
  </div>
</aside>

          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <a
    href="http://localhost:1313/post/reversing.kr/"
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2022-05-01 00:00:00 &#43;0000 UTC" itemprop="datePublished"
      >2022-05-01</time
    >
    <time style="display: none;" id="post-update-time"
      >2022-05-01</time
    >
  </a>
</div>

      <div class="article-category">
  
    <a
      class="article-category-link"
      href="/categories/writeup"
      data-aos="zoom-in"
      >WRITEUP</a
    >
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p><strong>Trước hết bạn cần có các tools cần thiết để dùng reverse:</strong></p>
<ul>
<li>IDA Pro</li>
<li>Detect it easy (DIE)</li>
<li>CTF Explorer</li>
<li>Resource Hacker</li>
<li>dnSpy</li>
</ul>
<h2 id="easy-crack---100pts">
<a class="header-anchor" href="#easy-crack---100pts"></a>
Easy Crack - 100pts
</h2><p>Mở file lên thì ta biết đây là 1 file check password</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174267344-c4849fc3-4968-4beb-b854-f8a939883420.png" alt="image"></p>
<p>Kiểm tra bằng <a href="https://github.com/horsicq/Detect-It-Easy">DiE</a> , ta thấy đây là 1 file PE32</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174267750-13d8b36f-e684-4307-a51d-e60ef66a7832.png" alt="image"></p>
<p>Mờ file bằng IDA 32bit, tại hàm <code>DialogFunc</code> có hàm <code>sub_401080</code>, nhìn sơ qua ta thấy hàm có sử dụng winapi <code>GetDlgItemTextA</code> và <code>MessageBoxA</code>, tức lấy thông tin từ ô nhập lưu vào biến <code>String</code>, kiểm tra và xuất thông báo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_401080</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hDlg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHAR</span> <span class="n">String</span><span class="p">[</span><span class="mi">97</span><span class="p">];</span> <span class="c1">// [esp+4h] [ebp-64h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+65h] [ebp-3h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+67h] [ebp-1h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">String</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">GetDlgItemTextA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">String</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">97</span> <span class="o">||</span> <span class="nf">strncmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Str2</span><span class="p">,</span> <span class="mi">2u</span><span class="p">)</span> <span class="o">||</span> <span class="nf">strcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">String</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">aR3versing</span><span class="p">)</span> <span class="o">||</span> <span class="n">String</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">69</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">MessageBoxA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="n">aIncorrectPassw</span><span class="p">,</span> <span class="n">Caption</span><span class="p">,</span> <span class="mh">0x10u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">MessageBoxA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Caption</span><span class="p">,</span> <span class="mh">0x40u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">EndDialog</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Dựa theo bảng ASCII và thứ tự các kí tự, ta truy xuất được pass như sau : <code>Ea5yR3versing</code></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174269389-2692b964-ab7c-4e44-83b6-5acaaab9d4fd.png" alt="image"></p>
<h2 id="easy-keygen---100pts">
<a class="header-anchor" href="#easy-keygen---100pts"></a>
Easy Keygen - 100pts
</h2><p>Đề cho ta 1 file <code>Readme.txt</code> và 1 file <code>Easy Keygen.exe</code></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174270121-3b063329-603a-4710-a519-53300fc89bdb.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174269902-0d478ba7-963f-4af8-af16-e544c73d370e.png" alt="image"></p>
<p>Trong bài này ta cần phải tìm hiểu cách mà chương trình tạo ra <code>serial</code> từ chính <code>name</code> mà người dùng nhập vào, đó cũng là bản chất của <code>keygen (Key generator)</code></p>
<p>File <code>Easy Keygen.exe</code> là file PE32, thử mở bằng IDA:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// ebp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// esi
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-130h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// [esp+Dh] [ebp-12Fh] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">Var</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="c1">// [esp+10h] [ebp-12Ch] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">Buffer</span><span class="p">[</span><span class="mi">197</span><span class="p">];</span> <span class="c1">// [esp+74h] [ebp-C8h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [esp+139h] [ebp-3h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// [esp+13Bh] [ebp-1h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Var</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">Buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Buffer</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v11</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">qmemcpy</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="s">&#34; 0&#34;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v7</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">(</span><span class="n">aInputName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">Var</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v3</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">strlen</span><span class="p">(</span><span class="n">Var</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sprintf</span><span class="p">(</span><span class="n">Buffer</span><span class="p">,</span> <span class="s">&#34;%s%02X&#34;</span><span class="p">,</span> <span class="n">Buffer</span><span class="p">,</span> <span class="n">Var</span><span class="p">[</span><span class="n">v3</span><span class="o">++</span><span class="p">]</span> <span class="o">^</span> <span class="n">v7</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Var</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">(</span><span class="n">aInputSerial</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">Var</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nf">strcmp</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span> <span class="n">Buffer</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print</span><span class="p">(</span><span class="n">aCorrect</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print</span><span class="p">(</span><span class="n">aWrong</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Đọc kĩ thì mình thấy sau khi chương trình nhận <code>name</code> từ người dùng sau đó chương trình lấy từng kí tự của name <code>xor</code> với lại mảng <code>v7</code> đã được tạo từ trước</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">sprintf</span><span class="p">(</span><span class="n">Buffer</span><span class="p">,</span> <span class="s">&#34;%s%02X&#34;</span><span class="p">,</span> <span class="n">Buffer</span><span class="p">,</span> <span class="n">Var</span><span class="p">[</span><span class="n">v3</span><span class="o">++</span><span class="p">]</span> <span class="o">^</span> <span class="n">v7</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</span></span></code></pre></div><p>Còn đây là cách khởi tạo của mảng <code>v7</code> dưới dạng code asm:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174272756-9d7d37eb-0201-4060-ac88-ea0e027e35f3.png" alt="image"></p>
<p><code>v7 = [0x10,0x20,0x30]</code></p>
<p>Vì <code>xor</code> có tính chất đối xứng, từ đó mình có thể viết ra được script solve như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">serial</span> <span class="o">=</span> <span class="s2">&#34;5B134977135E7D13&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v7</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">]),</span><span class="n">end</span> <span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="c1">#K3yg3nm3</span>
</span></span></code></pre></div><p><code>Name: K3yg3nm3</code></p>
<h2 id="easy-unpack---100pts">
<a class="header-anchor" href="#easy-unpack---100pts"></a>
Easy Unpack - 100pts
</h2><p>Trong Reverse Engineering có 1 kĩ thuật tên là Unpack, nghĩa là file bị pack sẽ khiến ta không thể còn đọc code như bình thường nữa:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174274976-8481253c-5a4c-4c77-af62-672d9fb02798.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174275841-4c2c28d8-472b-43be-8737-d39ccf00afd7.png" alt="image"></p>
<blockquote>
<p>Trong chương trình bình thường sẽ có 1 <code>EP(Entry Point)</code> gọi là điểm khởi đầu xuất phát của chương trình, tại điểm này trở đi, code sẽ được thực thi, trường hợp file bị pack, <strong>EP</strong> này có thể bị thay đổi.</p></blockquote>
<blockquote>
<p>Tùy the packer, chương trình sau khi bị pack sẽ có 1 vùng data, <strong>EP</strong> này sẽ bắt đầu thực hiện giải mã data thành code chương trình gốc. Sau khi giải mã xong nó mới bắt đầu thực hiện chương trình bằng <strong>EP</strong> gốc hay còn gọi là <code>OEP(Original-Entry-Point)</code>.</p></blockquote>
<p>Do đó, một trong những bước đầu tiên để unpack file đó chính là tìm ra <strong>OEP</strong> của chương trình, trong chall lần này đề chỉ yêu cầu tìm ra <strong>OEP</strong>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174277363-6e5e4c56-a816-42b6-aedb-9b3a18ded6cc.png" alt="image"></p>
<p>Dùng PE-Editor, mình tìm được EP hiện tại:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174277781-5da3c00b-5cf5-4ffd-92fa-1fb41a101d03.png" alt="image"></p>
<p>Mình tìm bằng cách dự đoán, nghĩa là code sau khi dược decrypt thì sẽ nhảy đến <strong>OEP</strong> để thực thi chương trình, tìm kĩ trong IDA ta thấy:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174279804-5a2ba587-e404-4e20-a869-0c7a838dab08.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174280264-892ed865-7ab4-480f-898f-76e4b44db5da.png" alt="image"></p>
<p>Tại khúc này mình thấy nó <code>jmp</code> thẳng từ dưới lên location 0x401150, mình dự đoán luôn, đây chính là <strong>OEP</strong></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174280105-5ef978c6-5efe-4dad-8c4f-24d33c9034ca.png" alt="image"></p>
<p><code>OEP:00401150</code></p>
<h2 id="easy-elf---100pts">
<a class="header-anchor" href="#easy-elf---100pts"></a>
Easy ELF - 100pts
</h2><p>Tương tự với file <code>exe</code> trên Windows, <code>ELF</code> sẽ là file thực thi trên hệ điều hành Linux</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174281001-b3721602-d421-40b2-a4ea-a8881d498781.png" alt="image"></p>
<p>Vì là file ELF nên mới vào ta mở và kiếm ngay hàm <code>main</code> để decompile:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#34;Reversing.Kr Easy ELF</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mh">0x17u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_8048434</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nf">sub_8048451</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub_80484F7</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#34;Wrong</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">6u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Bên trong <code>sub_8048434</code> thật ra chỉ là hàm nhập bình thường (bài này sẽ là nhập vào 1 chuỗi) , mình đã đổi tên biến lại cho dễ quan sát:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sub_8048434</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_8048650</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Tại câu điều kiện <code>if</code> có 1 hàm dùng để kiểm tra <code>input</code> của người dùng:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">_BOOL4</span> <span class="nf">CHECK</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">byte_804A021</span> <span class="o">!=</span> <span class="mi">49</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span> <span class="o">^=</span> <span class="mh">0x34u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">byte_804A022</span> <span class="o">^=</span> <span class="mh">0x32u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">byte_804A023</span> <span class="o">^=</span> <span class="mh">0x88u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">byte_804A024</span> <span class="o">!=</span> <span class="mi">88</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">byte_804A025</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">byte_804A022</span> <span class="o">!=</span> <span class="mi">124</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input</span> <span class="o">==</span> <span class="mi">120</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">byte_804A023</span> <span class="o">==</span> <span class="o">-</span><span class="mi">35</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mình thấy có mấy <code>byte</code> lạ lạ nên bấm vào xem thử, và mình thấy đây cũng chỉ là các kí tự tiếp theo của input vì nó nằm liên tiếp nhau:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174282581-4f434802-96f9-403e-a11c-65893ff00160.png" alt="image"></p>
<p>Mình đổi tên các biến lại, và giờ code đã dễ đọc hơn rất nhiều:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">_BOOL4</span> <span class="nf">CHECK</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input1</span> <span class="o">!=</span> <span class="mi">49</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span> <span class="o">^=</span> <span class="mh">0x34u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input2</span> <span class="o">^=</span> <span class="mh">0x32u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">input3</span> <span class="o">^=</span> <span class="mh">0x88u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input4</span> <span class="o">!=</span> <span class="mi">88</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input5</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input2</span> <span class="o">!=</span> <span class="mi">124</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">input</span> <span class="o">==</span> <span class="mi">120</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">input3</span> <span class="o">==</span> <span class="o">-</span><span class="mi">35</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mình rev lại đoạn này xong viết script py để giải nó đơn giản như sau (Hoặc các bạn cũng có thể giải tay, nhớ chuyển -35 thành số dương):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="o">^</span><span class="mh">0x34</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">49</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">124</span><span class="o">^</span><span class="mh">0x32</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xdd</span><span class="p">)</span><span class="o">^</span><span class="mh">0x88</span>
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">]))</span>
</span></span></code></pre></div><p>Password: <code>L1NUX</code></p>
<h2 id="replace---150pts">
<a class="header-anchor" href="#replace---150pts"></a>
Replace - 150pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/174284963-0859f88b-dafb-4d6a-b098-dbbdbcdcf444.png" alt="image"></p>
<p>Bài này vẫn là check password (chỉ được nhập vào kí tự là số), tuy nhiên khi mở IDA tìm hàm check thì mình không thấy, debug thử thì khi bấm <code>Check</code> nó bị lỗi như này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174285235-a266e0b8-f7fd-4793-bd35-51de2cf27808.png" alt="image"></p>
<p><code>40466F: Lệnh tại 0x40466F tham chiếu bộ nhớ tại 0x601605CB. Không thể ghi bộ nhớ -&gt; 601605CB</code></p>
<p>Thử nhập 1 số:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174285824-52cce0b2-f316-41e7-896f-c20f44e4d489.png" alt="image"></p>
<p>Vẫn là lỗi lệnh ở vị trí <code>40466F</code>,mình tìm thử trong data:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174286024-9f1e4bab-6457-42cd-a779-c1a26409649c.png" alt="image"></p>
<p>Tại đây chương trình thực hiện lệnh <code>call $+5</code> rất là lạ, mình đặt breakpoint và debug thử (input để trống):</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174287105-d55df6d0-6ef2-4f31-a03d-b654b4f0c9dc.png" alt="image"></p>
<p>Sau khi tắt debug, chạy lại với input = 4567, mình để ý <code>dword_4084D0</code> nó sẽ có giá trị thay đổi dựa theo input, cụ thể là input+2 và được cộng với <code>601605C7h</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174287785-ea396c0c-5db8-469c-b9dd-2812ed211ac6.png" alt="image"></p>
<p>Và nó được tăng thêm 2 lần trước khi được push và call (chổ <code>inc eax</code> và <code>inc dword_4084D0</code>)</p>
<p>Nghĩa là lỗi kia do không thể tìm thấy offset chính xác để call, ta cần tính toán cụ thể để ra được đúng địa chỉ, qua tab string, ta có:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174288099-8ca47fb5-3bd7-4138-b8b6-77c3e55e6bee.png" alt="image">
<img src="https://user-images.githubusercontent.com/88520787/174291594-50aa5fcd-cc30-4d07-8152-5bef9b53224d.png" alt="image"></p>
<p>Địa chỉ chính xác của mình chính là <code>0x00401071</code></p>
<p>Hộp thoại báo lỗi của chương trìn khi mình không nhập gì là <code>0x601605CB</code>, khi mình nhập <code>4567</code> thì sẽ là <code>0x601617A2</code> chính là <code>0x601605CB+ hex(4567)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">input + 2 + 0x601605C7 + 2 = 0x00401071
</span></span><span class="line"><span class="cl">input = (0x00401071 - 2 - 2 - 0x601605C7) &amp; 0xffffffff = 2687109798 // &amp; với 0xffffffff chuyển thành số dương
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/88520787/174293047-7aec64c1-d211-4992-a3f0-a90fdcc6520d.png" alt="image"></p>
<p><code>input = 2687109798</code></p>
<h2 id="imageprc---120pts">
<a class="header-anchor" href="#imageprc---120pts"></a>
ImagePrc - 120pts
</h2><p>Để xem đề cho cái gì đây</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174296085-4d4c8a99-08e2-4aa9-a280-a26bcc7373c8.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174296333-fc740095-b230-41a6-81aa-13c0a268b970.png" alt="image"></p>
<p>Một cái file có thể vẽ lên xong còn có nút <code>Check</code>, hmmm, mình đoán là nó sẽ so sánh hình mình vẽ với data có sẵn, vậy giờ kím data đó ở đâu?</p>
<p>Trước tiên mình thử tìm hàm <code>check</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__stdcall</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span> <span class="n">LPSTR</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nShowCmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">SystemMetrics</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">HWND</span> <span class="n">Window</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp-1Ch] [ebp-64h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">struct</span> <span class="n">tagMSG</span> <span class="n">Msg</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-44h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">WNDCLASSA</span> <span class="n">WndClass</span><span class="p">;</span> <span class="c1">// [esp+20h] [ebp-28h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="o">::</span><span class="n">hInstance</span> <span class="o">=</span> <span class="n">hInstance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">cbClsExtra</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">cbWndExtra</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">hbrBackground</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBRUSH</span><span class="p">)</span><span class="nf">GetStockObject</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">hCursor</span> <span class="o">=</span> <span class="nf">LoadCursorA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCSTR</span><span class="p">)</span><span class="mh">0x7F00</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">hInstance</span> <span class="o">=</span> <span class="n">hInstance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">hIcon</span> <span class="o">=</span> <span class="nf">LoadIconA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCSTR</span><span class="p">)</span><span class="mh">0x7F00</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">lpfnWndProc</span> <span class="o">=</span> <span class="n">sub_401130</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">lpszClassName</span> <span class="o">=</span> <span class="n">lpWindowName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">lpszMenuName</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WndClass</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">RegisterClassA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WndClass</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="nf">GetSystemMetrics</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">75</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">SystemMetrics</span> <span class="o">=</span> <span class="nf">GetSystemMetrics</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Window</span> <span class="o">=</span> <span class="nf">CreateWindowExA</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">             <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">lpWindowName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">lpWindowName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mh">0xCA0000u</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">SystemMetrics</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">v7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mi">150</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">hInstance</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ShowWindow</span><span class="p">(</span><span class="n">Window</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nf">GetMessageA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Msg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Msg</span><span class="p">.</span><span class="n">wParam</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">TranslateMessage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">DispatchMessageA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="nf">GetMessageA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Msg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Msg</span><span class="p">.</span><span class="n">wParam</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Trong Winmain có hàm <code>sub_401130</code> rất kì lạ, vào xem thử thì&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">case</span> <span class="mi">1u</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">DC</span> <span class="o">=</span> <span class="nf">GetDC</span><span class="p">(</span><span class="n">hWnd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">hbm</span> <span class="o">=</span> <span class="nf">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">DC</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">hdc</span> <span class="o">=</span> <span class="nf">CreateCompatibleDC</span><span class="p">(</span><span class="n">DC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">h</span> <span class="o">=</span> <span class="nf">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hbm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nf">Rectangle</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nf">ReleaseDC</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">DC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="o">::</span><span class="n">wParam</span> <span class="o">=</span> <span class="p">(</span><span class="n">WPARAM</span><span class="p">)</span><span class="nf">CreateFontA</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x81u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x12u</span><span class="p">,</span> <span class="n">pszFaceName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">dword_4084E0</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">CreateWindowExA</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">ClassName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">WindowName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mh">0x50000000u</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">85</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">80</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">28</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">hWnd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="n">HMENU</span><span class="p">)</span><span class="mh">0x64</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">hInstance</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nf">SendMessageA</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="n">dword_4084E0</span><span class="p">,</span> <span class="mh">0x30u</span><span class="p">,</span> <span class="o">::</span><span class="n">wParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span></code></pre></div><p>Có chổ hàm <code>CreateCompatibleBitmap()</code> mình biết được kích thước tấm ảnh của mình và của chương trình là <code>200x150</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="n">wParam</span> <span class="o">==</span> <span class="mi">100</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">GetObjectA</span><span class="p">(</span><span class="n">hbm</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bmi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biHeight</span> <span class="o">=</span> <span class="n">cLines</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biWidth</span> <span class="o">=</span> <span class="n">v16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSize</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biPlanes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biCompression</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">GetDIBits</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">hbm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cLines</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bmi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v8</span> <span class="o">=</span> <span class="n">operator</span> <span class="nf">new</span><span class="p">(</span><span class="n">bmi</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSizeImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">GetDIBits</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">hbm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cLines</span><span class="p">,</span> <span class="n">v8</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bmi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">ResourceA</span> <span class="o">=</span> <span class="nf">FindResourceA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCSTR</span><span class="p">)</span><span class="mi">101</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCSTR</span><span class="p">)</span><span class="mh">0x18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">Resource</span> <span class="o">=</span> <span class="nf">LoadResource</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ResourceA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v11</span> <span class="o">=</span> <span class="nf">LockResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v12</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v13</span> <span class="o">=</span> <span class="n">v8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v14</span> <span class="o">=</span> <span class="n">v11</span> <span class="o">-</span> <span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="n">v13</span> <span class="o">==</span> <span class="n">v13</span><span class="p">[</span><span class="n">v14</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">++</span><span class="n">v12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">++</span><span class="n">v13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">v12</span> <span class="o">&gt;=</span> <span class="mi">90000</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nf">sub_401500</span><span class="p">(</span><span class="n">v8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nf">MessageBoxA</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Caption</span><span class="p">,</span> <span class="mh">0x30u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">sub_401500</span><span class="p">(</span><span class="n">v8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>Còn đây sẽ là chổ so sánh từng <code>byte</code> với <code>bitmap</code> có sẵn, trước khi cmp thì hàm có dùng <code>GetDIBits,GetDIBits,FindResourceA,LoadResource</code>, xem như là lấy data lên trước khi so sánh, để xem được trong file có những vùng data nào thì mình dùng <code>ResourceHacker</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174300806-ef89e720-03d9-4a43-9100-88fe75e9535e.png" alt="image"></p>
<p>Rồi luôn, Nó đây, 0xFF đại diện cho màu trắng (màu sáng nhất) và ngược lại, giờ tì mình tìm cách để biến cái đống này thành bitmap có thể xem được</p>
<p>Để xem được ta cần có file header đúng chuẩn với header của bitmap, mình có thể lê mạng copy và thay vào hoặc là tạo 1 file bitmap bằng paint (nhớ điều chỉnh độ phân giải là 200x150 trước khi lưu):</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174301231-8c2ccddb-dbbf-430c-be70-77b48823c380.png" alt="image"></p>
<p>Sau khi lưu, mở file bằng Hxd (hoặc hex editor bất kì để chỉnh sửa hex):</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174301746-4dd7b445-9bfa-46ac-88eb-93852c1df0de.png" alt="image"></p>
<p>Copy data từ bên ResourceHacker qua và lưu lại thành tấm ảnh hoàn chỉnh.Mở lên thử hehe</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174302263-5d2b5b3f-f0ca-4819-9e35-246fac069e84.png" alt="image"></p>
<p><code>Key: GOT</code></p>
<h2 id="music-player---150pts">
<a class="header-anchor" href="#music-player---150pts"></a>
Music Player - 150pts
</h2><p>Không hiểu sao bài này lại là bài làm mình stuck nhiều nhất</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174303891-7ae9cf75-2fbd-4ba6-bdc6-e51390173817.png" alt="image"></p>
<p>Trong file ReadMe có nói rõ là bài này ta sẽ tìm hàm check và pass qua chổ đó:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">This MP3 Player is limited to 1 minutes.
</span></span><span class="line"><span class="cl">You have to play more than one minute.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">There are exist several 1-minute-check-routine.
</span></span><span class="line"><span class="cl">After bypassing every check routine, you will see the perfect flag.
</span></span></code></pre></div><p>Khi chạy tới 1 phút sẽ có 1 cái MsBox hiện cái gì đó lên như thế này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174304052-73f1d28a-d5cf-4510-a404-7769f94ba959.png" alt="image"></p>
<p>Vì hàm và tên hàm rất lộn xộn, mình lay hoay mãi mà không tìm đc chổ check, ban đầu mình tìm <code>Msbox</code> nhưng cũng không thấy</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174304442-e1ac13c4-a76e-4180-8546-21f299a17a78.png" alt="image"></p>
<p>Chợt nhớ ra trong bài này có kèm theo 1 file <code>.dll</code>, vậy nên mình kiểm tra xem chương trình đã import những gì để sử dụng những, check thử tab import:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174304807-6dd9d5e1-55e8-4536-a004-633c6c786fae.png" alt="image"></p>
<p>Mãi đến giờ thì mình mới thấy cái <code>WinAPI</code> này:))), giờ bấm đúp vào với dùng <code>xref</code>( bấm X) xem coi những thằng nào gọi nó:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174305049-c5aa7d38-6579-4a47-baae-022714691a06.png" alt="image"></p>
<p>Một đống luôn:))</p>
<p>Sau khi check và debug một hồi thì mình tìm được chổ cái <code>msbox 1??????</code> mà nó từng hiện lên là cái này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174305318-02bd256f-496f-479f-a85c-ed1e454d86a9.png" alt="image"></p>
<p>Mà để nhảy tới chổ này thì có câu điều kiện này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174305681-74d408ed-128b-491b-8c8f-184152b0b6da.png" alt="image"></p>
<p>Vì sau lệnh này, nó bắt buộc phải nhảy tới block khác, nếu không nó sẽ nhảy vào block chứa <code>Msbox fail</code></p>
<p>Trước đó nó có chổ <code>cmp eax, 60000</code> và cũng có nghĩa là cmp với <code>60000ms = 1p</code>, nếu lớn hơn thì không jump và đi vào <code>FAIL</code>, ngược lại thì jump.</p>
<p>Để bypass lệnh mình dùng Plugin IDA do người Việt viết có tên là <a href="https://github.com/keystone-engine/keypatch">keypatch</a>, cho phép mình chỉnh sửa lệnh trực tiếp bằng tổ hợp phím <code>Ctrl + Alt + K</code>, mình đổi lệnh <code>jl</code> thành <code>jmp</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174306841-517627bd-5e68-4ef3-89b0-87647030aeae.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174306980-f61985d8-01e6-45f4-a142-6197a1d2979d.png" alt="image"></p>
<p>Lưu vào input file và chạy thử:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174307101-e3c98c61-a32c-49b1-af22-d3be6a19263a.png" alt="image"></p>
<p>Vẫn còn lỗi ạ, stuck tiếp :&laquo;&lt;, mình nghĩ là vẫn còn thêm chổ check nữa,</p>
<p>Sau khi pass qua được chổ kia, mình lần theo <code>jmp</code> của nó thì thấy được thêm 1 chổ này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174307455-d277f084-9169-45b2-baa0-d963063a25db.png" alt="image"></p>
<p><code>call    ds:__vbaHresultCheckObj</code></p>
<p>Chắc chổ này phá cái bài của mình, làm tương tự như bước trên, mình pass qua cái check này bằng lệnh <code>jmp</code> luôn:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174307735-bf87074e-a1c9-4c2b-a032-9c40228af217.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174307803-6a4d44e2-15a3-4e72-806e-1665772b361d.png" alt="image"></p>
<p>Chạy thử lần nữa:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174307945-d3a70636-e598-43d7-8a37-47f62d0d5980.png" alt="image"></p>
<p>File lần này chạy mượt lắm nha, không có lỗi gi:)))</p>
<h2 id="cshop---120pts">
<a class="header-anchor" href="#cshop---120pts"></a>
CSHOP - 120pts
</h2><p>Bài này mình thấy khá dễ so với những bài ở trên, nhưng không hiểu sao lại ít người làm hơn</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174309513-cc1827e2-c3ea-4fc4-8007-1b7f306de652.png" alt="image"></p>
<p>Một cái file trắng tinh tươm&hellip;..</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174308938-472716fa-e8e2-425f-a944-dd45f1d2dda2.png" alt="image"></p>
<p>Bài này là dotNet nên mình đã dùng <a href="https://github.com/dnSpy/dnSpy">dnSpy</a> để phân tích:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174309235-e47dd68d-a6b6-4e95-a887-40e96f0e0976.png" alt="image"></p>
<p>Theo kinh nghiệm của mình code của bài này đã bị obfuscate, ban đầu mình nghĩ là sẽ unobfuscate trước sau đó phân tích sau, nhưng khi đọc sơ qua thì mình thấy có 1 chổ hơi bất ổn:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174309728-0d6f0712-3de7-40de-96f4-e0af47e046e2.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174309814-741aee6f-c3d9-44d4-be15-b06d2025274c.png" alt="image"></p>
<p>Đây là một cái <code>button</code> nhưng mà sao lại set size bằng 0,0 thế kia, mình thử chỉnh size to hơn một tí:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174309976-49fdbfd7-5bb8-4c15-ba09-73976e0eb44a.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174310045-215cf9cc-cac7-4fc4-87c6-b7cbccfa2740.png" alt="image"></p>
<p>Sửa thành 100,100 sau đó lưu file lại</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174310141-a3bfc71c-a639-4982-9dd5-e47eb151c00c.png" alt="image"></p>
<p>Chạy thử thấy cái nút to quá, bấm thử ra flag luôn:))</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174310346-e3b0c96e-1bf0-42ba-a9d2-fd7cc203d950.png" alt="image"></p>
<h2 id="position---160pts">
<a class="header-anchor" href="#position---160pts"></a>
Position - 160pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/174311267-1eeff0fa-5025-4aa8-835c-b2882bb46610.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174311676-f7fb9ba3-4280-486d-ba33-ca6083ec7b6a.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174311246-8735c204-32db-4831-9e58-7adc73f6fb58.png" alt="image"></p>
<p>Tiếp tục là một bài keygen nữa</p>
<p>Lấy kinh nghiệm từ bài trước (Musicplayer), lần này mình check tab <code>import</code> và <code>string</code> trước và thứ mình cần tìm là chổ nào in ra <code>Wrong</code> hoặc là chổ nào sẽ nhận input của mình:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174312296-b820aed7-1615-4c31-b9c5-6c9de50095de.png" alt="image"></p>
<p>Mình thấy có chổ <code>GetWinDowTextW</code>, xref tới xem những thằng nào gọi nó:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174312530-f994a579-ee71-48a2-a27c-9f0ad6c779a6.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174312705-c7a0556f-ea2a-4b3c-be7f-003806bfe4c7.png" alt="image"></p>
<p>Có 2 chổ gọi và lưu vào biến <code>v50</code> và <code>v51</code>, trong đó <code>v50</code> có check điều kiện là <code>[a-z]</code> nên mình khá chắc đây là name, còn lại là serial, mình đã đổi tên lại cho dễ nhìn</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174313331-9fa4dd20-f462-4ecc-aaa2-50d4abab0f98.png" alt="image"></p>
<p>Đoạn này thật ra chỉ check xem name có kí tự nào trùng nhau hay không thôi</p>
<p>Rồi bây giờ mới bắt đầu check tên:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174313917-72bd5b06-eef4-4105-9c06-2e2a926023ee.png" alt="image"></p>
<p>Mình ngẫm sơ qua 1 hồi thì, serial chỉ có thể có giá trị 6,7,8 vì điều kiện của kí tự đầu tiền luôn +5, kí tự tiếp theo +1</p>
<p>Mình đã copy và sửa tên thành tên khác dễ hiểu hơn:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c1_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c1</span> <span class="o">+</span> <span class="n">c1_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c5</span> <span class="o">+</span> <span class="n">c5_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c3</span> <span class="o">+</span> <span class="n">c3_</span><span class="p">)</span><span class="o">==</span> <span class="mi">8</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c4</span> <span class="o">+</span> <span class="n">c4_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c2</span> <span class="o">+</span> <span class="n">c2_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/88520787/174314842-98bb1ebb-eb98-4027-894e-5c413cbbb9c7.png" alt="image"></p>
<p>Tương tự với kí tự thứ 3 và kí tự cuối cùng</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">c6</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c6_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c6</span> <span class="o">+</span> <span class="n">c6_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c10</span> <span class="o">+</span> <span class="n">c10_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c8</span> <span class="o">+</span> <span class="n">c8_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c9</span> <span class="o">+</span> <span class="n">c9_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c7</span> <span class="o">+</span> <span class="n">c7_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span></code></pre></div><p>Tổng hợp lại, mình có hàm check như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">check</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">c4</span><span class="p">,</span><span class="n">c5</span><span class="p">,</span><span class="n">c1_</span><span class="p">,</span><span class="n">c2_</span><span class="p">,</span><span class="n">c3_</span><span class="p">,</span><span class="n">c4_</span><span class="p">,</span><span class="n">c5_</span><span class="p">,</span><span class="n">c6</span><span class="p">,</span><span class="n">c7</span><span class="p">,</span><span class="n">c8</span><span class="p">,</span><span class="n">c9</span><span class="p">,</span><span class="n">c10</span><span class="p">,</span><span class="n">c6_</span><span class="p">,</span><span class="n">c7_</span><span class="p">,</span><span class="n">c8_</span><span class="p">,</span><span class="n">c9_</span><span class="p">,</span><span class="n">c10_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c1_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5 so dau cua serial
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c1</span> <span class="o">+</span> <span class="n">c1_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c5</span> <span class="o">+</span> <span class="n">c5_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c3</span> <span class="o">+</span> <span class="n">c3_</span><span class="p">)</span><span class="o">==</span> <span class="mi">8</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c4</span> <span class="o">+</span> <span class="n">c4_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c2</span> <span class="o">+</span> <span class="n">c2_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">c6</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c6_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//5 so sau cua serial
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c6</span> <span class="o">+</span> <span class="n">c6_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c10</span> <span class="o">+</span> <span class="n">c10_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c8</span> <span class="o">+</span> <span class="n">c8_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c9</span> <span class="o">+</span> <span class="n">c9_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c7</span> <span class="o">+</span> <span class="n">c7_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">check</span> <span class="o">==</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Giờ mình bruteforce 3 kí tự đầu của pass thôi, 26^3 chắc nhanh mà :&gt;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">check</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">c4</span><span class="p">,</span><span class="n">c5</span><span class="p">,</span><span class="n">c1_</span><span class="p">,</span><span class="n">c2_</span><span class="p">,</span><span class="n">c3_</span><span class="p">,</span><span class="n">c4_</span><span class="p">,</span><span class="n">c5_</span><span class="p">,</span><span class="n">c6</span><span class="p">,</span><span class="n">c7</span><span class="p">,</span><span class="n">c8</span><span class="p">,</span><span class="n">c9</span><span class="p">,</span><span class="n">c10</span><span class="p">,</span><span class="n">c6_</span><span class="p">,</span><span class="n">c7_</span><span class="p">,</span><span class="n">c8_</span><span class="p">,</span><span class="n">c9_</span><span class="p">,</span><span class="n">c10_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c4_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c3_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c2_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c1_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c5_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5 so dau cua serial
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c1</span> <span class="o">+</span> <span class="n">c1_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c5</span> <span class="o">+</span> <span class="n">c5_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c3</span> <span class="o">+</span> <span class="n">c3_</span><span class="p">)</span><span class="o">==</span> <span class="mi">8</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c4</span> <span class="o">+</span> <span class="n">c4_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c2</span> <span class="o">+</span> <span class="n">c2_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">c6</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c9_</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c8_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c7_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c6_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">c10_</span> <span class="o">=</span> <span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//5 so sau cua serial
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c6</span> <span class="o">+</span> <span class="n">c6_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c10</span> <span class="o">+</span> <span class="n">c10_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c8</span> <span class="o">+</span> <span class="n">c8_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c9</span> <span class="o">+</span> <span class="n">c9_</span><span class="p">)</span><span class="o">==</span> <span class="mi">7</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span> <span class="o">+=</span> <span class="p">((</span><span class="n">c7</span> <span class="o">+</span> <span class="n">c7_</span><span class="p">)</span><span class="o">==</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">check</span> <span class="o">==</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">brutePass</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span><span class="kt">int</span> <span class="n">length</span><span class="p">,</span><span class="n">string</span> <span class="n">set</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="nf">size</span><span class="p">()</span><span class="o">==</span><span class="n">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">c</span><span class="p">:</span><span class="n">set</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">string</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">name</span><span class="o">+</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nf">check</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="sc">&#39;p&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">temp</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">brutePass</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">length</span><span class="p">,</span><span class="n">set</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">string</span> <span class="n">set</span> <span class="o">=</span> <span class="s">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">brutePass</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">set</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Có 4 kết quả:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174315558-22bce8ad-8c70-40e8-b1fd-26bc692c50c2.png" alt="image"></p>
<p>Thấy cái đầu hợp lí nhất nên thử luôn:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174315709-986c6481-344f-4928-96f0-5c19d7e505c2.png" alt="image"></p>
<h2 id="direct3d-fps---140pts">
<a class="header-anchor" href="#direct3d-fps---140pts"></a>
Direct3D FPS - 140pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/174316869-66684374-34f7-42e3-ba7c-fb0d35fe14ed.png" alt="image"></p>
<p>Adu tự nhiên có game fps chơi:)))</p>
<p>Nhiệm vụ của mình là đi clear mấy con này, bắn nào hết thì có pass:&gt;</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174319167-dd1c2e52-b490-47e0-8e8f-bd7dcaa57c37.png" alt="image"></p>
<p>Bắn xong mình cũng k thấy cái gì luôn:))</p>
<p>Chơi zui xíu thôi, vào phân tích nào, thử tìm trong string mình có thấy cái này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174319773-34d278e0-58cb-40fa-9234-337583d4cd93.png" alt="image"></p>
<p>Mình trace ra thì thấy hàm <code>sub_4039C0</code> có gọi tới chổ này:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="nf">sub_4039C0</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dword_409194</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="mi">132</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">result</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_40F8B4</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">MessageBoxA</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">aCkfkbulileEZf</span><span class="p">,</span> <span class="s">&#34;Game Clear!&#34;</span><span class="p">,</span> <span class="mh">0x40u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="nf">SendMessageA</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="mi">2u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Trong lúc xuất ra thông báo <code>Game Clear</code> thì cũng có kèm theo đoạn chuỗi này, nhưng nhìn có vẻ không ổn lắm:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174320168-673747cd-88d4-48e6-bca9-b081674e6ecf.png" alt="image"></p>
<p>Mình thử xref thì thấy nó còn được đem đi xor, khác chắc là decryt</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174320281-1b4e1a97-8c4d-474a-b6f4-72b11c5fa066.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">__thiscall</span> <span class="nf">sub_403400</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// edx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">=</span> <span class="nf">sub_403440</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="n">dword_409190</span><span class="p">[</span><span class="mi">132</span> <span class="o">*</span> <span class="n">result</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">dword_409190</span><span class="p">[</span><span class="mi">132</span> <span class="o">*</span> <span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">dword_409194</span><span class="p">[</span><span class="mi">132</span> <span class="o">*</span> <span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">data</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">^=</span> <span class="n">byte_409184</span><span class="p">[</span><span class="mi">528</span> <span class="o">*</span> <span class="n">result</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mình đã đổi tên biến thành data cho dễ nhìn, nó được lấy từng kí tự đem đi xor với các <code>byte_409184</code>, xem thử chổ <code>byte_409184+528 này có gì</code></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174320674-1c5cb6c2-a6ca-4ef9-828e-0a754777b418.png" alt="image"></p>
<p>Mình thử dùng python có sẵn trong IDA thì được kết quả như này: (0x002D9184 là vị trí của byte_409184)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  Python&gt;b = 0x002D9184 
</span></span><span class="line"><span class="cl">  Python&gt;get_bytes(b,1)
</span></span><span class="line"><span class="cl">  b&#39;\x00&#39;
</span></span><span class="line"><span class="cl">  Python&gt;get_bytes(b+518,1)
</span></span><span class="line"><span class="cl">  b&#39;S&#39;
</span></span><span class="line"><span class="cl">  Python&gt;b = 0x002D9184
</span></span><span class="line"><span class="cl">  Python&gt;get_bytes(b,1)
</span></span><span class="line"><span class="cl">  b&#39;\x00&#39;
</span></span><span class="line"><span class="cl">  Python&gt;get_bytes(b+528,1)
</span></span><span class="line"><span class="cl">  b&#39;\x04&#39;
</span></span><span class="line"><span class="cl">  Python&gt;get_bytes(b+528*2,1)
</span></span><span class="line"><span class="cl">  b&#39;\x08&#39;
</span></span></code></pre></div><p>Mình dự đoán được rằng byte_409184 sẽ là một mảng từ 0,4,8,12,16&hellip;rồi dùng đem xor với data có sẵn mà chúng ta đã thấy</p>
<p>Minh viết scipt này để lấy data và <code>byte_409184</code> ra sau đó đem xor với nhau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="mh">0x0407028</span> <span class="c1">#data start address</span>
</span></span><span class="line"><span class="cl"><span class="n">j</span> <span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&#34;big&#34;</span><span class="p">)</span><span class="o">^</span><span class="n">j</span><span class="p">),</span><span class="n">end</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span><span class="o">+=</span><span class="mi">4</span>
</span></span></code></pre></div><p>Dùng chức năng load script file của IDA để chạy file py:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174325081-31fabc3b-ad36-4374-b29f-18593f2703a8.png" alt="image"></p>
<p>Kết quả là:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174325163-7001307a-5fdd-4bf6-91cc-1c634a58b7f9.png" alt="image"></p>
<h2 id="multiplicative---170pts">
<a class="header-anchor" href="#multiplicative---170pts"></a>
Multiplicative - 170pts
</h2><p>Lần này ta sẽ rev file jar</p>
<p>Mình dùng <code>jadx</code> để <code>decompile</code> ra:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174328214-7d8ca6bf-1492-4587-a903-aa4af26c9855.png" alt="image"></p>
<p>Nhìn sơ qua thì source code khá đơn giản chỉ là nhận vào rồi kiểm tra, tuy nhiên nó không dễ như bình thường</p>
<p>Mình đã thử</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174329285-a99e3944-9583-4a24-b989-9b235cef3d27.png" alt="image"></p>
<p>Bài này dùng phép nhân trước khi tính toán, nên mình chăc chắn đây là overflow luôn</p>
<p>Kiểu <code>long</code> có 64 bit cho nên số lớn nhất sẽ là 2^63-1, sau khi lớn hơn giá trị này nó sẽ quay về -2^63, vậy nên ta sẽ tính toán giá trị hợp lí cho nó quay về
-1536092243306511225</p>
<p>Chuyển -1536092243306511225 sang số không dấu ta được 0xeaaeb43e477b8487</p>
<p>Theo như tính chất của overflow, thì (0xeaaeb43e477b8487 + 2^64.n) sẽ là bội số của 26729, vậy nên mình có script như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">)</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0xeaaeb43e477b8487</span><span class="p">)</span><span class="o">%</span><span class="mi">26729</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">)</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0xeaaeb43e477b8487</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">c_int64</span><span class="p">(</span><span class="mi">253087792599051741660295</span><span class="o">//</span><span class="mi">26729</span><span class="p">))</span>
</span></span></code></pre></div><p>Kết quả là
<code>-8978084842198767761</code></p>
<h2 id="ransomware---120pts">
<a class="header-anchor" href="#ransomware---120pts"></a>
ransomware - 120pts
</h2><p>Còn về phần bài này, đề cho 1 <code>file</code> và 1 file <code>run.exe</code>, và file readme có nói rõ:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447216-4d87a54f-863f-4d9b-b7f9-77099a1acd51.png" alt="image"></p>
<p>Vì đề bài là ransomware(1 loại virus phá hoại) mình biết là bằng cách nào đó, cái file này đã làm mã hóa <code>file</code> khiến cho nó không thể hoạt động được:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447530-ef62a808-b867-4c99-a0c7-ad5149f3f6fa.png" alt="image"></p>
<p>Còn đây là file exe, sau khi nhập key bừa thì mình phát hiện <code>file</code> đã bị thay đổi nội dung:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447602-5fa9e63d-4181-4859-86b3-7caf78d774b2.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447627-d60eaf5f-6774-4826-bf4f-88ae58261d15.png" alt="image"></p>
<p>Giờ nhiệm vụ của mình là tìm đúng key để giải mã cái đống này thôi:&gt;</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447651-630560f8-614d-4aa6-ae35-c79fe8a34242.png" alt="image"></p>
<p>File <code>run.exe</code> là file đã packed, mình dùng extentions có sẵn của <code>CFF Explorer</code> để unpack nó:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447704-b0b0ac42-53c6-4dc7-82a4-affa201969fb.png" alt="image"></p>
<p>Lưu thành file mới và đưa vào <code>IDA</code> xem thử nào:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447752-11eb765c-0576-4cb6-99aa-b1bba54c0720.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447778-46b1592a-0931-43e1-bfc7-44d648560ebf.png" alt="image"></p>
<p>Đây là hàm main, phía trên còn có khúc <code>pusha</code> <code>popa</code> rất nhiều, tạm thời ta không cần quan tâm</p>
<p>Để ý các bạn có thể thấy, chương trình có đoạn dùng fopen mở file có tên là <code>file</code>, mode là <code>rb</code>, nghĩa là đọc bytes từ file mà đề cho</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448790-aec21cbb-adff-466a-85d6-0d882ba384f2.png" alt="image"></p>
<p>Trong suốt chương trình thì ta luôn thấy nó gọi tới hàm <code>sub_401000</code>, nhưng mà nội dung của nó cũng k có gì đặc biệt, ta bỏ qua tiếp</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174447923-3a15e1b4-1dd6-48bb-9514-7744ef932ced.png" alt="image"></p>
<p>Quay trở lại vấn đề chính, sau khi gọi lệnh đọc file, thì đoạn này chương trình sẽ có vòng lặp lấy từng byte của file sau đó lưu vào <code>byte_5415B8</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448009-d749410e-e452-4334-b8e9-2ca08427243c.png" alt="image"></p>
<p>Sau khi đọc hết file, chương trình nhảy tới đoạn <code>loc_44A8A5</code></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448050-509e7a1b-a31f-44aa-a283-a3d0aa89c43b.png" alt="image"></p>
<p>Qua quá trình debug thì mình mới biết <code>[ebp+var_8]</code> sẽ là biến đếm từ 0 tới <code>[ebp+var_10]</code>(độ dài của <code>file</code>), nếu nhỏ hơn thì tiếp tục vòng lặp, tạm gọi là <code>i</code> và <code>n</code>.</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448177-2e49835c-02d2-445a-86a4-824c7cf3bd55.png" alt="image"></p>
<p>Đoạn này có 3 lệnh <code>xor</code>, tuy nhiên khúc <code>xor</code> đầu tiên chỉ là để clear thanh ghi <code>edx</code>, ngoài ra còn có đoạn dùng <code>div</code> cho <code>[ebp+var_C]</code> (độ dài của key từ người dùng), <code>div</code> sẽ lấy <code>eax</code> chia cho thanh ghi toán hạng nguồn, sau đó lưu số dư vào <code>edx</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">movsx   edx, byte_44D370[edx]
</span></span></code></pre></div><p>byte_44D370 chính là key của người dùng nhập vào,</p>
<p>Sau đó các file bytes của chúng ta còn được <code>xor</code> với 0xFF, tổng kết lại, mình đọc được đoạn nó encrypt như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">byte</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">byte</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">^</span><span class="mh">0xFF</span>
</span></span></code></pre></div><p>Trong đó <code>key</code> và <code>len(key)</code> đều không biết được, nên là mình đã nghĩ tởi bruteforce key, nhưng không được :V</p>
<p>Mình đã thử lấy file gốc <code>xor</code> với <code>0xFF</code> trước:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file_new&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span></code></pre></div><p>Mở <code>file_new</code> bằng HxD, mình thấy có vài thứ hay ho:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448552-079ad4c5-c1b5-4de8-b668-deb408ce8a0c.png" alt="image"></p>
<p>Mình thấy có 1 đoạn text có thể đọc được và lặp đi lặp lại rất nhiều lần, chắc chắn đây là key luôn, thử nhập vào file <code>run.exe</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448601-8b61888f-c259-4ff9-885f-58bd2c36bcf4.png" alt="image"></p>
<p>Mở <code>file</code> lên thử:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448620-81ba3592-4357-46a4-8ca1-a2518cbb9189.png" alt="image"></p>
<p>Có vẻ như là key đúng rồi, nhưng mà sao để chạy file này đây?</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448677-4d6b4643-4528-4580-9cea-49a663f4393f.png" alt="image"></p>
<p>Dùng DiE thì mình thấy đây là file thực thi 32bits và packed, unpack và đưa vào ida xem thử:v</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174448711-8607cf41-db47-4620-93df-55f43ab56ae2.png" alt="image"></p>
<p>Có luôn:)) <code>Colle System</code></p>
<h2 id="hateintel---150pts">
<a class="header-anchor" href="#hateintel---150pts"></a>
HateIntel - 150pts
</h2><p>Nghe tên bài và icons là mình biết bài này dùng cái gì luôn:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174478661-2a12a2f0-f12b-46fb-b52e-96aed1e73d33.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/174478675-9f6b842e-9192-4eca-9cb4-0342b58e8e7f.png" alt="image"></p>
<p>File đề cho là file thực thi trên <code>macOS</code>, tuy nhiên file dùng compiler là <code>gcc</code> nên code vẫn là code C như thông thường, IDA hoàn toàn có thể hỗ trợ decompile:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174478751-6224cad1-5aff-4784-8dc6-4ab630209174.png" alt="image"></p>
<p><code>macOS</code> sẽ dùng kiến trúc <code>ARM (arm architecture)</code> thay vì <code>intel_x86,_x64</code> mà mấy bài trước chúng ta rev, tập lệnh của <code>ARM</code> có đặc điểm nhận diện là thường viết HOA hết các lệnh, nhưng mà đây chỉ là kiến thức thêm, trong phạm vi bài này, ta chỉ đọc code C thuần nên không quan tâm lắm, còn đây là hàm <code>main()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sub_2224</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">__s</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span> <span class="c1">// [sp+4h] [bp-5Ch] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [sp+54h] [bp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [sp+58h] [bp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+5Ch] [bp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Input key : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">__s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">__s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">sub_232C</span><span class="p">(</span><span class="n">__s</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">__s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">byte_3004</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Wrong Key! &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Correct Key! &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Chương trình lấy chuỗi của người dùng nhập vào, sau đó đưa vào hàm <code>sub_232C</code> (tạm gọi là hàm encrypt) xử lí, sau đó so sánh với các <code>byte</code> có sẵn trong data chương trình:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/174479003-3116bc2e-db87-41c5-9aac-8a741b3dee49.png" alt="image"></p>
<p>Vào trong hàm <code>encrypt</code> xem thử:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">signed</span> <span class="kr">__int32</span> <span class="kr">__fastcall</span> <span class="nf">encrypt</span><span class="p">(</span><span class="kt">signed</span> <span class="kr">__int32</span> <span class="n">result</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">__s</span><span class="p">;</span> <span class="c1">// [sp+4h] [bp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+8h] [bp-Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">signed</span> <span class="kr">__int32</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [sp+Ch] [bp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">__s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">result</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">__s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">__s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nf">sub_2494</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">__s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Hàm này duyệt qua chuỗi 4 lần (a2 = 4), mỗi lần từng kí tự sẽ được thay đổi bởi hàm <code>sub_2494</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">sub_2494</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [sp+8h] [bp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+Ch] [bp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="n">a1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">v3</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">v3</span> <span class="o">|=</span> <span class="mi">1u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Hàm <code>sub_2494</code> cũng có 1 vòng lặp, nhưng a2 = 1, nên ta xem như không có vòng lặp, ta chỉ quan tâm logic của hàm, mình thấy có đoạn <code>v3 |= 1u;</code> nên mình nghĩ hàm này sẽ xử lí thao tác bit:</p>
<p>Code của hàm sẽ trông dễ hiểu hơn:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">rotate</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">c</span> <span class="o">|=</span> <span class="mi">1u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">c</span><span class="p">;</span> <span class="c1">// lấy 8 bits cuối
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Cả đoạn này hiểu như sau: dịch 8 bits của kí tự sang trái, lấy bit đầu tiên thêm vào cuối, hay nói cách khác là <code>rotate bits</code>, khi rotate 4 lần thì 4 bits đầu thành 4 bits cuối và ngược lại, với data <code>bytes</code> có sẵn, mình có script để rev như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xF6</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span><span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span><span class="mh">0x92</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">last</span> <span class="o">=</span> <span class="n">byte</span><span class="o">&gt;&gt;</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="n">first</span> <span class="o">=</span> <span class="n">byte</span><span class="o">&amp;</span><span class="mh">0xF</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">last</span> 
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">end</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="c1">#Do_u_like_ARM_instructi0n?:)</span>
</span></span></code></pre></div><p>Result: <code>Do_u_like_ARM_instructi0n?:)</code></p>
<h2 id="x64-lotto---140pts">
<a class="header-anchor" href="#x64-lotto---140pts"></a>
x64 Lotto - 140pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/175609167-9b0bb3c3-ffc9-41b0-aac8-e95cd718a205.png" alt="image">
<img src="https://user-images.githubusercontent.com/88520787/175609094-948b13af-b68b-49a1-bac9-eb602665eec6.png" alt="image"></p>
<p>Đề cho mình 1 file PE64, sau khi nhập bừa thì màn hình quay về ban đầu và bắt nhập lại, thử đưa vào ida:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="nf">wmain</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// r8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// edx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">k</span><span class="p">;</span> <span class="c1">// rcx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="c1">// rdx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// rcx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// al
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// ecx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="o">*</span><span class="n">v9</span><span class="p">;</span> <span class="c1">// rdx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// ax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// ax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n1</span><span class="p">;</span> <span class="c1">// [rsp+40h] [rbp-78h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n2</span><span class="p">;</span> <span class="c1">// [rsp+44h] [rbp-74h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n3</span><span class="p">;</span> <span class="c1">// [rsp+48h] [rbp-70h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n4</span><span class="p">;</span> <span class="c1">// [rsp+4Ch] [rbp-6Ch] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n5</span><span class="p">;</span> <span class="c1">// [rsp+50h] [rbp-68h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">n6</span><span class="p">;</span> <span class="c1">// [rsp+54h] [rbp-64h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v19</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// [rsp+58h] [rbp-60h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v20</span><span class="p">;</span> <span class="c1">// [rsp+64h] [rbp-54h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v21</span><span class="p">;</span> <span class="c1">// [rsp+68h] [rbp-50h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v22</span><span class="p">;</span> <span class="c1">// [rsp+6Ch] [rbp-4Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v23</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span> <span class="c1">// [rsp+70h] [rbp-48h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int16</span> <span class="n">v24</span><span class="p">;</span> <span class="c1">// [rsp+A2h] [rbp-16h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">n2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">n3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">n4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">n5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">n6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v19</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v19</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v19</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v21</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v22</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v0</span> <span class="o">=</span> <span class="nf">time64</span><span class="p">(</span><span class="mi">0</span><span class="n">i64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">srand</span><span class="p">(</span><span class="n">v0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wprintf</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;</span><span class="se">\n\t\t</span><span class="s">L O T T O</span><span class="se">\t\t\n\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wprintf</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;Input the number: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wscanf_s</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;%d %d %d %d %d %d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wsystem</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;cls&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Sleep</span><span class="p">(</span><span class="mi">500u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">v19</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">byte_7FF658B935F0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span> <span class="n">v19</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">++</span><span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">6</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">goto</span> <span class="n">LABEL_9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">byte_7FF658B935F0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_9</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="mi">6</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="n">byte</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">92</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">184</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">139</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">184</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">107</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">66</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">56</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">237</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">219</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">91</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">129</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">126</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">140</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mi">134</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="mi">245</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v23</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="mi">242</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v24</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v7</span> <span class="o">=</span> <span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">+=</span> <span class="mi">5</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v20</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">v7</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v21</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v21</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v23</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v23</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v9</span> <span class="o">=</span> <span class="n">v23</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v10</span> <span class="o">=</span> <span class="o">*</span><span class="n">v9</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v11</span> <span class="o">=</span> <span class="n">v8</span><span class="o">++</span> <span class="o">+</span> <span class="p">(</span><span class="n">v10</span> <span class="o">^</span> <span class="mh">0xF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="p">(</span><span class="n">v9</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">v11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v24</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wprintf</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v23</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">wprintf</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">1</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mình đã đổi tên mọt số biến để dễ nhìn hơn, cụ thể là, chương trình bắt mình nhập 6 số:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">wscanf_s</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;%d %d %d %d %d %d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n6</span><span class="p">);</span>
</span></span></code></pre></div><p>Và sau đó 6 số này sẽ lần lượt được so sánh với 6 số ngẫu nhiên được khởi tạo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">v19</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
</span></span></code></pre></div><p>May mắn là, mình phát hiện 6 số này không sử dụng mục đích nào khác ngoài kiểm tra xem có đúng không, thế nên là mình bỏ qua luôn.</p>
<p>Ngoài ra mình thấy có đoạn khởi tạo giá trị và decrypt password của mình:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v7</span> <span class="o">=</span> <span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">+=</span> <span class="mi">5</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v20</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">v7</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v21</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v21</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v23</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v23</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="n">byte</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Thử đặt breakpoint chổ này để thiết lập cho nó thoát khỏi vòng lặp nhập input:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175610913-3de9cae1-5428-427d-94a3-927d9733cd5c.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175610933-e2d21af2-f6ad-475d-b5be-6ec818c64127.png" alt="image"></p>
<p>Chọn <code>Local windows debugger</code> và bắt đầu debug</p>
<p>Sau khi nhập bừa 6 số, quay lại màn hình debug:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611420-349dddf4-748d-4247-8b1a-42166d470dc5.png" alt="image"></p>
<p>Chổ này chương trình kiểm tra xem 6 số có dúng hết không, nó đã dùng lệnh <code>jnz</code>, nếu không phải 0 (ZF = 0) thì sẽ jump tới chổ nhập input:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611472-e7a32dbb-64da-47fd-b5a4-fa21b7fae060.png" alt="image"></p>
<p>Để bypass chổ này, mình sửa ZeroFlag bằng 1:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611583-a39d8b38-a79c-4a32-9bb5-fe6c35e29828.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611608-e0e6628c-f398-4f52-8f33-7fd8ebb10c8a.png" alt="image"></p>
<p>Ngoài ra, sau khi decrypt vẫn còn 1 điều kiện khác nữa:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611728-fecbef61-ddbb-4de8-89be-2c025a793ba9.png" alt="image"></p>
<p>Đặt breakpoint và làm tương tự với chổ này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175611857-eaade76d-aaaf-47e7-80da-a21bbcee28a7.png" alt="image"></p>
<p>Lần này chương trình dùng lệnh <code>jz</code> (jump if zero, ZF = 1), chỉ cần sửa ngược lại so với lệnh ở trên là dc:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175612049-36e1bda5-6ac8-40df-95ef-1f095c46b890.png" alt="image"></p>
<p>Chổ này chương trình sẽ in ra thứ gì đó có vẻ giống password:))</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175612195-4d1e8b1b-c408-4632-9c5f-e9d5999a3b2a.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175612238-8a7613b6-ff5e-4784-8ccf-7242315cfa85.png" alt="image"></p>
<p>Password: <code>from_GHL2_-_!</code></p>
<p>Nói chung là bài này khá cơ bản, các bạn không cần phải rev hết chương trình, chỉ cần chú tâm đến vài chổ quan trọng thay đổi flow cả chương trình rồi rev từ đó ra là được, Chúc các bạn thành công</p>
<h2 id="autohotkey1---130pts">
<a class="header-anchor" href="#autohotkey1---130pts"></a>
AutoHotKey1 - 130pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/175991963-e7a56564-5cde-4d1a-af28-8d46dad30097.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175988385-30754bb2-f3e7-4d69-909b-d2c12e385d3c.png" alt="image"></p>
<p>Sau khi mình nhập input bừa thì chương trình dừng ngay lập tức</p>
<p>Đề cho mình 1 file packed bằng UPX:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175988332-8314608f-e5f2-4024-8da8-b1584377e437.png" alt="image"></p>
<p>Mình thử dùng UPX 3.96 để unpack file này ra nhưng sau khi chạy thì nó hiện thông báo lỗi:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175988655-619a140c-ab9b-4bfa-8da1-938b7c42a82b.png" alt="image"></p>
<p>Mình thử tìm trong string doạn <code>Exe corrupted</code> và xref thử thì có 2 hàm này dùng tới nó:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175989019-e8e7a7a2-52f1-42f7-a8fb-77e81fafdd24.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175989120-63f6e026-8e1e-4947-b8ac-5baf0b14cb0e.png" alt="image"></p>
<p>Dựa vào offset biết được, mình dùng x32dbg để debug file này và trace cho tới đoạn này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175989352-3875e997-d50a-423d-9612-4fa3661cc048.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175989703-d99886c2-b522-46ba-845b-25b6e8befa92.png" alt="image"></p>
<p>Nhìn kĩ lên trên một chút thì ta thấy có đoạn <code>je</code> sẽ jump qua khỏi đoạn kiểm tra này, nên mình đặt breakpoint tại đấy và chỉnh <code>ZeroFlag = 1</code>:</p>
<p>Sau khi pass qua được thì khi chạy 1 lúc, bạn sẽ thấy MD5 của <code>DecryptKey</code> xuất hiện:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175990774-f55ea52d-1220-4f28-9ba8-941cd639434d.png" alt="image"></p>
<p><code>220226394582d7117410e3c021748c2a</code></p>
<p>Decrypt MD5 bằng tool online (<a href="https://md5decrypt.net/)">https://md5decrypt.net/)</a>, ta được:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175991123-4fa3dc6d-1a35-453f-ab00-e5559a1614ed.png" alt="image"></p>
<p>Tìm nốt phần còn lại thôi:)))</p>
<p>Lần này mình quay lại chương trình gốc, sau khi các đoạn code được mã hoắ, debug thì mình biết được chương trình sẽ thực hiện khi gọi hàm này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175991472-993dc768-6b0d-46a3-a7f7-6814eeac4fd0.png" alt="image"></p>
<p>Thử đặt breakpoint, step into là làm tương tự:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175991645-4dd9d163-b4f2-42fa-9a8d-180fccaa2b44.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/175991722-602f71fa-98dd-47f1-88cf-057d1907df2d.png" alt="image"></p>
<p>Tới đây thì mình thấy được đoạn so sánh <code>pwd hash</code>, tương tự, decrypt md5 của đoạn này:
<code>54593f6b9413fc4ff2b4dec2da337806</code>
Kết quả:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/175992283-41bfeb4f-b13f-4531-9f32-6e1ac0df27ee.png" alt="image"></p>
<p>Password: <code>isolated pawn</code></p>
<h2 id="csharp---160pts">
<a class="header-anchor" href="#csharp---160pts"></a>
CSHARP - 160pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/176389387-7534f063-0c8b-4dac-980d-1a44a4fca05f.png" alt="image"></p>
<p>Vì là Csharp nên mình dùng dnSpy64:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176389614-781ee2a6-aa20-441b-a8bb-433cd44881fe.png" alt="image"></p>
<p>Sau khi file nhận input của mình thì nó sẽ chuyển thành bytes base64, và sau đó chạy qua hàm Invoke này để kiểm tra:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176389941-f4ac457c-2648-4d38-b461-be7ccea95e9d.png" alt="image"></p>
<p>Đặt breakpoint tại chổ gọi hàm và debug:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176390002-6e0008ae-8e7a-4894-8843-c51dc8790628.png" alt="image"></p>
<p>Bấm F11 để step into thân hàm:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176390241-72b39f89-3be8-4801-a39b-ad62681c4936.png" alt="image"></p>
<p>Tiếp tục F11:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176390449-cf4176d5-3500-4504-a4e0-2104853ebea2.png" alt="image"></p>
<p>Tại đây thì chương trình nó làm một vài thao tác check cơ bản nhưng nói chung là mình không quan tâm, chỉ quan tâm đoạn return của hàm:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176390608-9a926d6c-c685-4356-8546-fdda92c60699.png" alt="image"></p>
<p>Step into:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176390670-8ebfa3a1-7057-45d7-a827-b64e6d20036e.png" alt="image"></p>
<p>Trong hàm này, ta thấy có đoạn <code>RuntimeMethodHandle</code> khá đáng nghi, nên mình nghĩ chương trình này dùng hàm trong lúc chạy nên lúc trước mình không thể static analysis được:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176391039-5a977ab3-7a75-4372-885a-4022caa80238.png" alt="image"></p>
<p>Step into:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176391146-55176a9c-ad84-41cb-891f-fb767ab58fca.png" alt="image"></p>
<p>Copy qua python và chỉnh sửa lại:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">^</span> <span class="mi">74</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">51</span> <span class="o">^</span> <span class="mi">70</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">^</span> <span class="mi">87</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span> <span class="o">^</span> <span class="mi">77</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">^</span> <span class="mi">44</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">144</span> <span class="o">^</span> <span class="mi">241</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">68</span> <span class="o">^</span> <span class="mi">29</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">102</span> <span class="o">^</span> <span class="mi">49</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">181</span> <span class="o">^</span> <span class="mi">226</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span> <span class="o">^</span> <span class="mi">238</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">238</span> <span class="o">^</span> <span class="mi">163</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">51</span> <span class="o">^</span> <span class="mi">117</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">]))</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1">#dYnaaMic</span>
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/88520787/176393006-bd072f64-f908-41cd-94f7-86eec8a3eac0.png" alt="image"></p>
<p>Password: <code>dYnaaMic</code></p>
<h2 id="twist1---190pts">
<a class="header-anchor" href="#twist1---190pts"></a>
Twist1 - 190pts
</h2><p>Bài này trong lúc mình đang làm khá stuck nên mình có thử tham khảo vài nguồn trên internet và làm như sau:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176819235-fe72b7c4-1dc9-4b74-b2dc-319ac79ef7ee.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/176819384-a0fe4272-c901-4512-99b7-317accf1956a.png" alt="image"></p>
<p>Bài này sẽ thuộc dạng input-check cơ bản</p>
<p>Thử đưa vào ida xem thử:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176820275-d23ebccd-f8f7-4215-96b0-e4ecbd14b2c0.png" alt="image"></p>
<p>Rất ít hàm và cũng không tìm thấy OEP nên mình nghĩ là đây là một file packed bằng 1 cách nào đó</p>
<p>Khi chạy thì nó hiện ra lỗi như này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176822322-5716b239-4a1b-4367-b89f-713b384d4d03.png" alt="image"></p>
<p>Chương trình dừng ở ngay lệnh <code>pop ss</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176822419-77b43bc3-984c-41e8-9726-1c274193d4d7.png" alt="image"></p>
<p>Qua tìm hiểu thì mình biết thêm một số thứ về <a href="https://daehee87.tistory.com/23">pop ss</a>:</p>
<blockquote>
<p><code>pop ss</code> sẽ thực hiện lệnh tiếp theo và ngăn lệnh hiện tại cho tới khi lệnh tiếp theo được thực hiện</p></blockquote>
<p>Ngoài ra, khi mình debug có thấy đoạn vòng lặp chổ <code>loc_407063</code>, khi chạy đoạn này thì các đoạn code lần lượt xuất hiện phía bên dưới, đây sẽ là đoạn decryot, nên mình đăt breakpoint tại <code>0040706F</code> để lấy được toàn bộ code hoàn thiện.</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176835355-952dfe1d-4e3a-48dc-8eca-5f43d514cc0d.png" alt="image"></p>
<p>Bài này sẽ thuần theo tên bài luôn, nó sẽ có rất nhiều kĩ thuật anti-debug phổ biến.</p>
<p>Chuyển sang x32dbg, sau khi các đoạn code được decrypt, mình nhận thấy có một chổ <code>mov eax,dword ptr fs:[30]</code> kì lạ:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176838660-e6575685-ca29-4fc7-8ade-151fccbf58a4.png" alt="image"></p>
<p>Vẫn là sau khi tim hiểu trên (stackoverflow)[https://stackoverflow.com/questions/14496730/mov-eax-large-fs30h], mình mới biết đây tiếp tục là một cơ chế antidebug.</p>
<p>Đoạn này có nghĩa là eax được thiết lập để chỉ ra một điểm trong cấu trúc của PEB trong process.</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176841990-671e3a12-51f2-4e62-bf4b-98b6b418205e.png" alt="image"></p>
<p>Sau lệnh trên, eax có giá trị là:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176843244-aecad1fe-3445-478b-baf3-9a429da35bd2.png" alt="image"></p>
<p>Như vậy địa chỉ cấu trúc của PEB sẽ là <code>0x332000</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176843485-fe9419f1-32e5-49c5-bf09-fc438f8903b5.png" alt="image"></p>
<p><code>edx</code> được mov giá trị 0 sau khi <code>ecx</code> được clear,sau đó nó sẽ được mov giá trị 0x28, kết quả này đem xor với 0x30 (result = 0x18) rồi được cộng trực tiếp vào eax hay địa chỉ của PEB, hay nói cách khác, nó được trỏ tới <code>địa chỉ của PEB + 0x18</code>.</p>
<p>Cấu trúc PEB được cấu hình hơi khác nhau trong các phiên bản x32 và x64 khác nhau. Trong trường hợp này, ta xét trên cấu trúc 32bit, trong trường hợp này, edx sẽ trỏ tới <code>ProcessHeap (PEB + 0x18)</code>.</p>
<p>Tại trong <code>twist1.40709F</code>, ProcessHeap sẽ được cộng thêm 0xC và so sánh với <code>2</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176845230-20a187f2-8a9e-4307-b9f4-ade92dc0b008.png" alt="image"></p>
<blockquote>
<p>+0x000 Entry : _HEAP_ENTRY</p></blockquote>
<blockquote>
<p>+0x008 Signature : Uint4B</p></blockquote>
<blockquote>
<p>+0x00c Flags : Uint4B</p></blockquote>
<blockquote>
<p>+0x010 ForceFlags : Uint4B</p></blockquote>
<blockquote>
<p>+0x014 VirtualMemoryThreshold : Uint4B</p></blockquote>
<blockquote>
<p>+0x018 SegmentReverse : Uint4B</p></blockquote>
<blockquote>
<p>+0x01c SegmentCommit : Uint4B</p></blockquote>
<blockquote>
<p>+0x020 DecommitFreeBlockThreshold : Uint4B</p></blockquote>
<p>Vậy nó sẽ trỏ đến Flags, nên là đoạn so sánh sẽ xác minh rằng tiến trình đang chạy bình thường.</p>
<p>Tương tự tại <code>004070D5</code> cũng sẽ có đoạn ProcessHeap + 0x10 để truy cập tới ForceFlags và xác minh tương tự.</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176846239-16057111-7cec-4c7e-81dd-b9c3a9db8a55.png" alt="image"></p>
<p>Để bypass qua đoạn test này, bạn cần chỉnh cho tanh ghi ecx có giá trị bằng với ebx:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176846875-9103c54b-f7ce-47a4-9d36-628ae45dbb0e.png" alt="image"></p>
<p>Tiếp theo, ta có 1 đoạn khác là:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176847528-bf7b4bea-6aba-4b43-a67a-cf24ffdff204.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/176847999-8fd3370a-52e8-466e-8f22-15d419831780.png" alt="image"></p>
<p>Lân này,con trỏ edx- 0x10 để quay về PEB gốc, sau đó chương trình dùng PEB + 0xC, nó sẽ trỏ tới <code>_PEB_LDR_DATA</code>, tiếp theo <code>_PEB_LDR_DATA + 0x10</code> để dùng <code>InInitializationOrderLinks</code>(dựa vào LDR_DATA_TABLE_ENTRY để tìm kiếm).</p>
<p>Ldr thực hiện kiểm tra xem có đang debug hay không bằng cách liên tục so sánh với lại 0xEEFEEEFE hay 0xABABABAB không để check xem debugger có lắp đầy phần không sử dụng của heap bằng 0xABABABAB hoặc 0xEEFEEEFE hay không, cụ thể là nó so sánh 0x1F4 lần:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176849317-fcf94f0b-f98d-408c-b8a5-6ee055c3d22a.png" alt="image"></p>
<p>Tại vị trí <code>407183</code> vẫn còn 1 vòng lặp, đặt breakpoint tại nop để thoát khỏi vòng lặp:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176849709-901455cd-578c-49c9-91c7-c3f06be65143.png" alt="image"></p>
<p>Sau đó, chương trình nhảy tới <code>40157C</code> và dường như đây chính là entrypoint, tới đây, xem như chương trình đã được unpack hoàn toàn:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176849975-22efff0e-c43c-41f4-a757-c565dd8e3491.png" alt="image"></p>
<p>Khi cho chương trình chạy tới lệnh tại vị trí <code>40129B</code> thì nó bị lỗi như này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176851410-68254567-b772-4fed-ab27-fecdcec20cae.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/176851427-627d699e-9cbf-4610-be3c-091bbe27f6ae.png" alt="image"></p>
<p>Nó nói rằng không thể tham chiếu đến địa chỉ hiện tại của edx, trên edx lại có 1 địa chỉ rất lạ, thử đổi thành địa chỉ kế tiếp của lệnh là <code>40129D</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176851553-b7a99faf-a641-48bc-b3b1-f897344b8966.png" alt="image"></p>
<p>Tiếp theo ta sẽ thấy chổ nhập input:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176852219-7d235f90-8641-4608-abfa-a602df15d7e1.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/176852330-cb01d4ad-c9ad-4922-bd2b-6cd435113cfa.png" alt="image"></p>
<p><code>twis1.401240</code> sẽ là hàm kiểm tra input của mình.
Khi debug vào bên trong, tại đây mình sẽ thấy nơi chứa input của mình:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176858799-458f2715-f3c4-4250-9642-9696d63a25c0.png" alt="image"></p>
<p>Vị trí của input là:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176862526-2f1d57a9-d5ab-4932-984d-a9cd7d39a364.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/176859783-31cb7954-6cf8-4471-86df-ae91a3178e04.png" alt="image"></p>
<p>Tại đây ta sẽ tìm đc al = 0x77^0x35 = &ldquo;B&rdquo;; (Kí tự thứ 3)</p>
<p>Khi debug, ta sẽ thấy có đoạn gọi hàm này:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176864410-1eb86c83-3caa-448e-ae64-cf2ff68999c7.png" alt="image"></p>
<p>Pass qua đoạn này để không bị vướng vào debug trap:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/176864834-0011a585-a3ca-4e35-a354-8fdaf4f1d6ff.png" alt="image"></p>
<p>Làm tương tự với các kí tự còn lại, ta được chuối tương ứng</p>
<p>Input: <code>RIBENA</code>.</p>
<p>Bài này tương đối khó, mình thật sự stuck rất nhiều ở bài này</p>
<h2 id="pepassword---150pts">
<a class="header-anchor" href="#pepassword---150pts"></a>
PEpassword - 150pts
</h2><p><img src="https://user-images.githubusercontent.com/88520787/177202208-95da6640-4549-4521-a031-5b2a810d23ec.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202246-f6cdbaad-a872-48b3-8313-175f7f39a247.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202254-12bc92a3-adf5-4c3f-913a-3e242d65a7ba.png" alt="image"></p>
<h3 id="originalexe">
<a class="header-anchor" href="#originalexe"></a>
Original.exe:
</h3><p><img src="https://user-images.githubusercontent.com/88520787/177202290-87c8d844-c219-4cd1-946e-509dd5497338.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202328-9acab6d6-a967-43fe-a698-3fadd23facca.png" alt="image"></p>
<p>File Original sẽ là file trước khi packed, cơ bản thì nó xor 2 mảng với nhau, còn đây là khi mình đặt breakpoint để xem giá trị nó trước khi print:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202486-41bfc631-1fe9-45e7-abd8-ea7bf918c241.png" alt="image"></p>
<p>Chỉ toàn là <code>?</code> (giống như lúc đầu, nên mình cũng không phân tích gì thêm)</p>
<h3 id="packedexe">
<a class="header-anchor" href="#packedexe"></a>
Packed.exe:
</h3><p><img src="https://user-images.githubusercontent.com/88520787/177202634-e1b691dc-4a40-4ae2-931d-8fa9e62b5aef.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202658-34e7554d-3912-40e7-ac2e-dce7a7111647.png" alt="image"></p>
<p>Vì là file packed nên là lúc đầu file bắt nhập pass, mình đoán là nó sẽ lấy pass này để decrypt cái file thành file gốc, file gốc đơn giản và không cần rev gì thêm</p>
<p>Sau khi debug thì mình tìm được chổ để file nó lấy input của mình:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202777-af87812f-037f-4a49-ba7e-d874a7c56341.png" alt="image"></p>
<p>Mình đã đổi tên cho dễ hiểu, tạm thời mình bỏ qua đoạn nhập pass word và đi thẳng đến đoạn nó lấy password xử lí bằng cách pass qua các lệnh <code>jz</code> bằng cách mod giá trị <code>ZF</code> và trace tới hàm process:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177202969-034cc63d-0243-4a9a-b414-5e2bf50290c6.png" alt="image"></p>
<p>Hàm này sẽ lấy input của mình lưu vào ebx và eax để xử lí, nó sẽ thao tác hàng loạt giữa <code>eax</code> và <code>ebx</code>(4bits) và giá trị trả về của hàm này sẽ là <code>eax</code> (ebx cố định):</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177203119-2ac63f7b-2c96-4a27-87aa-23a44c70360e.png" alt="image"></p>
<p>Trong trường hợp này, return <code>eax</code> sẽ sử dụng giải mã cho đoạn 0x401004 và có giá trị là 0x5a5a7e05</p>
<p>Và vì 1 lí do là sau khi xor eax với <code>.text</code> ở packed xong thì đoạn đó sẽ trở thành đoạn ở original, nên là mình dùng HxD để trace tới 2 đoạn đó:</p>
<p>Original.exe:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177203763-e961f1bc-7a91-46f8-a7fc-22a0887681d0.png" alt="image"></p>
<p>Packed.exe:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177203808-b34e92a7-c96b-444c-ae19-f376cec0d45d.png" alt="image"></p>
<p><code>eax = Packed(0x014cec81) ^ Original(0xb6e62e17) = 0xb7aac296</code></p>
<p>Và vì có <code>eax</code>, <code>ebx</code> cố định nên mình có thể brutefroce để tìm ebx:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span>  <span class="nf">rol</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">count</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4294967295</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">num1</span> <span class="o">|</span> <span class="n">num2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ror</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">rol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span> <span class="o">-</span> <span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//funtion : internet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0xffffffff</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ebx</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eax</span> <span class="o">=</span> <span class="mh">0xb7aac296</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">al</span> <span class="o">=</span> <span class="n">eax</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ebx</span> <span class="o">=</span> <span class="nf">rol</span><span class="p">(</span><span class="n">ebx</span><span class="p">,</span> <span class="n">al</span> <span class="o">%</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">eax</span> <span class="o">=</span> <span class="n">eax</span> <span class="o">^</span> <span class="n">ebx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bh</span> <span class="o">=</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">eax</span> <span class="o">=</span> <span class="nf">ror</span><span class="p">(</span><span class="n">eax</span><span class="p">,</span> <span class="n">bh</span> <span class="o">%</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">==</span> <span class="mh">0x5a5a7e05</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;ebx : 0x%08x</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ebx : 0xa1beee22
</span></span><span class="line"><span class="cl">ebx : 0xc263a2cb
</span></span></code></pre></div><p>Có 2 giá trị hợp lí, mình đã thử cả 2, thay vào <code>eax</code> và <code>ebx</code> tại lệnh tại vị trí <code>0040921F</code>:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177204711-87e627af-7aaa-405c-b3ff-f24b6f108e7b.png" alt="image"></p>
<p>Cho chương trình chạy:</p>
<p><img src="https://user-images.githubusercontent.com/88520787/177204732-b09fcbae-7022-4577-9eb6-14b225bb53d8.png" alt="image"></p>
<p>Password: <code>From_GHL2_!!</code>
(Tham khảo)</p>
<h2 id="windowkernel---220pts">
<a class="header-anchor" href="#windowkernel---220pts"></a>
WindowKernel - 220pts
</h2><h3 id="overview">
<a class="header-anchor" href="#overview"></a>
Overview
</h3><p><img src="https://i.imgur.com/LykQYNo.png" alt=""></p>
<p><img src="https://i.imgur.com/eUpDHNu.png" alt=""></p>
<p><img src="https://i.imgur.com/erQ3Bmj.png" alt=""></p>
<p><img src="https://i.imgur.com/ldH9Dty.png" alt=""></p>
<p><img src="https://i.imgur.com/28ORsYB.png" alt=""></p>
<h3 id="approach">
<a class="header-anchor" href="#approach"></a>
Approach
</h3><p>Check file <code>WindowKernel.exe</code> bằng DiE và mở bằng ida:</p>
<p><img src="https://i.imgur.com/7dcnwSs.png" alt=""></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">INT_PTR __stdcall DialogFunc(HWND hWnd, UINT a2, WPARAM a3, LPARAM a4)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  if ( a2 == 272 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    SetDlgItemTextW(hWnd, 1001, L&#34;Wait.. &#34;);
</span></span><span class="line"><span class="cl">    SetTimer(hWnd, 0x464u, 0x3E8u, 0);
</span></span><span class="line"><span class="cl">    return 1;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( a2 != 273 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    if ( a2 == 275 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      KillTimer(hWnd, 0x464u);
</span></span><span class="line"><span class="cl">      sub_401310();
</span></span><span class="line"><span class="cl">      return 1;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( (unsigned __int16)a3 == 2 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    SetDlgItemTextW(hWnd, 1001, L&#34;Wait.. &#34;);
</span></span><span class="line"><span class="cl">    sub_401490();
</span></span><span class="line"><span class="cl">    EndDialog(hWnd, 2);
</span></span><span class="line"><span class="cl">    return 1;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( (unsigned __int16)a3 == 1002 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    if ( HIWORD(a3) == 1024 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      Sleep(0x1F4u);
</span></span><span class="line"><span class="cl">      return 1;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return 1;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  if ( (unsigned __int16)a3 != 1003 )
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">  sub_401110(hWnd);
</span></span><span class="line"><span class="cl">  return 1;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Nếu xem các hàm lướt qua thì các bạn có thể biết là <code>sub_401310();</code> và <code>sub_401490();</code> sẽ không có gì đặc biệt ngoài báo lỗi và check các thứ.</p>
<p>Riêng hàm <code>sub_401110(hWnd);</code> sẽ có chổ <code>Correct!</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">HWND __thiscall sub_401110(HWND hDlg)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  HWND result; // eax
</span></span><span class="line"><span class="cl">  HWND v3; // eax
</span></span><span class="line"><span class="cl">  HWND v4; // eax
</span></span><span class="line"><span class="cl">  HWND DlgItem; // eax
</span></span><span class="line"><span class="cl">  WCHAR String[256]; // [esp+8h] [ebp-204h] BYREF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  GetDlgItemTextW(hDlg, 1003, String, 512);
</span></span><span class="line"><span class="cl">  if ( lstrcmpW(String, L&#34;Enable&#34;) )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    result = (HWND)lstrcmpW(String, L&#34;Check&#34;);
</span></span><span class="line"><span class="cl">    if ( !result )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      if ( sub_401280(0x2000) == 1 )
</span></span><span class="line"><span class="cl">        MessageBoxW(hDlg, L&#34;Correct!&#34;, L&#34;Reversing.Kr&#34;, 0x40u);
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">        MessageBoxW(hDlg, L&#34;Wrong&#34;, L&#34;Reversing.Kr&#34;, 0x10u);
</span></span><span class="line"><span class="cl">      SetDlgItemTextW(hDlg, 1002, &amp;word_4021F0);
</span></span><span class="line"><span class="cl">      DlgItem = GetDlgItem(hDlg, 1002);
</span></span><span class="line"><span class="cl">      EnableWindow(DlgItem, 0);
</span></span><span class="line"><span class="cl">      return (HWND)SetDlgItemTextW(hDlg, 1003, L&#34;Enable&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  else if ( sub_401280(4096) )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    v3 = GetDlgItem(hDlg, 1002);
</span></span><span class="line"><span class="cl">    EnableWindow(v3, 1);
</span></span><span class="line"><span class="cl">    SetDlgItemTextW(hDlg, 1003, L&#34;Check&#34;);
</span></span><span class="line"><span class="cl">    SetDlgItemTextW(hDlg, 1002, &amp;word_4021F0);
</span></span><span class="line"><span class="cl">    v4 = GetDlgItem(hDlg, 1002);
</span></span><span class="line"><span class="cl">    return SetFocus(v4);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    return (HWND)MessageBoxW(hDlg, L&#34;Device Error&#34;, L&#34;Reversing.Kr&#34;, 0x10u);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Theo như mình debug được thì <code>lstrcmpW(String, L&quot;Enable&quot;)</code> và <code>lstrcmpW(String, L&quot;Check&quot;);</code> sẽ là lúc mà mình bấm nút &ldquo;Enable&rdquo; cùa file <code>WindowKernel.exe</code>.</p>
<p>Mình chỉ để ý đến hàm <code>sub_401280(0x2000) == 1</code>, để kiểm tra điều kiện và trả về giá trị đúng để in ra &ldquo;Correct!&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __usercall sub_401280@&lt;eax&gt;(HWND a1@&lt;edi&gt;, DWORD dwIoControlCode)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  HANDLE FileW; // esi
</span></span><span class="line"><span class="cl">  DWORD BytesReturned; // [esp+4h] [ebp-8h] BYREF
</span></span><span class="line"><span class="cl">  int OutBuffer; // [esp+8h] [ebp-4h] BYREF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  FileW = CreateFileW(L&#34;\\\\.\\RevKr&#34;, 0xC0000000, 0, 0, 3u, 0, 0);
</span></span><span class="line"><span class="cl">  if ( FileW == (HANDLE)-1 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    MessageBoxW(a1, L&#34;[Error] CreateFile&#34;, L&#34;Reversing.Kr&#34;, 0x10u);
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  else if ( DeviceIoControl(FileW, dwIoControlCode, 0, 0, &amp;OutBuffer, 4u, &amp;BytesReturned, 0) )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    CloseHandle(FileW);
</span></span><span class="line"><span class="cl">    return OutBuffer;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    MessageBoxW(a1, L&#34;[Error] DeviceIoControl&#34;, L&#34;Reversing.Kr&#34;, 0x10u);
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Ở đây có đoạn nó tạo file và để cho nó trả về 1 thì mình để ý chổ này:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">DeviceIoControl</span><span class="p">(</span><span class="n">FileW</span><span class="p">,</span> <span class="n">dwIoControlCode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">OutBuffer</span><span class="p">,</span> <span class="mi">4u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">BytesReturned</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>Cơ bản thì nó là viết tắt của Device In Out Control, quay lại check file <code>WinKer.sys</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">NTSTATUS</span> <span class="n">__stdcall</span> <span class="n">DriverEntry</span><span class="p">(</span><span class="n">_DRIVER_OBJECT</span> <span class="o">*</span><span class="n">DriverObject</span><span class="p">,</span> <span class="n">PUNICODE_STRING</span> <span class="n">RegistryPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="ne">int</span> <span class="n">v3</span><span class="p">;</span> <span class="o">//</span> <span class="n">edi</span>
</span></span><span class="line"><span class="cl">  <span class="n">PDEVICE_OBJECT</span> <span class="n">v4</span><span class="p">;</span> <span class="o">//</span> <span class="n">ecx</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="o">//</span> <span class="n">et1</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="o">//</span> <span class="n">et1</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="o">*</span><span class="n">v7</span><span class="p">;</span> <span class="o">//</span> <span class="n">et1</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="n">v8</span><span class="p">;</span> <span class="o">//</span> <span class="n">al</span>
</span></span><span class="line"><span class="cl">  <span class="n">struct</span> <span class="n">_KDPC</span> <span class="o">*</span><span class="n">v9</span><span class="p">;</span> <span class="o">//</span> <span class="n">esi</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="o">*</span><span class="n">v10</span><span class="p">;</span> <span class="o">//</span> <span class="n">et1</span>
</span></span><span class="line"><span class="cl">  <span class="n">struct</span> <span class="n">_UNICODE_STRING</span> <span class="n">DestinationString</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="n">Ch</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">134</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="n">union</span> <span class="n">_LARGE_INTEGER</span> <span class="n">Interval</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">14</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">12</span><span class="n">Ch</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="n">PDEVICE_OBJECT</span> <span class="n">DeviceObject</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">1</span><span class="n">Ch</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">124</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="n">PVOID</span> <span class="n">P</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">20</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">120</span><span class="n">h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">CCHAR</span> <span class="n">Number</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">24</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">11</span><span class="n">Ch</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">struct</span> <span class="n">_OSVERSIONINFOW</span> <span class="n">VersionInformation</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">28</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">118</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">DbgSetDebugFilterState</span><span class="p">(</span><span class="mh">0x65</span><span class="n">u</span><span class="p">,</span> <span class="mi">3</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="n">u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">DbgPrint</span><span class="p">(</span><span class="s2">&#34;Driver Load!! </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">DriverObject</span><span class="o">-&gt;</span><span class="n">DriverUnload</span> <span class="o">=</span> <span class="p">(</span><span class="n">PDRIVER_UNLOAD</span><span class="p">)</span><span class="n">sub_1131C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">dword_13030</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">VersionInformation</span><span class="o">.</span><span class="n">dwOSVersionInfoSize</span> <span class="o">=</span> <span class="mi">276</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">RtlGetVersion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">VersionInformation</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MajorVersion</span> <span class="o">=</span> <span class="n">VersionInformation</span><span class="o">.</span><span class="n">dwMajorVersion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">MinorVersion</span> <span class="o">=</span> <span class="n">VersionInformation</span><span class="o">.</span><span class="n">dwMinorVersion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">PsGetVersion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MajorVersion</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MinorVersion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">RtlInitUnicodeString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DestinationString</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\\</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">PVOID</span><span class="p">)</span><span class="n">IoCreateDevice</span><span class="p">(</span><span class="n">DriverObject</span><span class="p">,</span> <span class="mi">4</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DestinationString</span><span class="p">,</span> <span class="mh">0x22</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DeviceObject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="ne">int</span><span class="p">)</span><span class="n">P</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RtlInitUnicodeString</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SymbolicLinkName</span><span class="p">,</span> <span class="n">L</span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">DosDevices</span><span class="se">\\</span><span class="s2">RevKr&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="n">IoCreateSymbolicLink</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SymbolicLinkName</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DestinationString</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v4</span> <span class="o">=</span> <span class="n">DeviceObject</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">DriverObject</span><span class="o">-&gt;</span><span class="n">MajorFunction</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">PDRIVER_DISPATCH</span><span class="p">)</span><span class="n">sub_11288</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">DriverObject</span><span class="o">-&gt;</span><span class="n">MajorFunction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">PDRIVER_DISPATCH</span><span class="p">)</span><span class="n">sub_112F8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">DriverObject</span><span class="o">-&gt;</span><span class="n">MajorFunction</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">PDRIVER_DISPATCH</span><span class="p">)</span><span class="n">sub_112F8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span><span class="o">-&gt;</span><span class="n">DeviceExtension</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">SystemArgument2</span> <span class="o">=</span> <span class="n">DeviceObject</span><span class="o">-&gt;</span><span class="n">DeviceExtension</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">SystemArgument2</span> <span class="o">=</span> <span class="n">DeviceObject</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">KeNumberProcessors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">::</span><span class="n">P</span> <span class="o">=</span> <span class="n">ExAllocatePool</span><span class="p">(</span><span class="n">NonPagedPool</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="o">*</span><span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">KeInitializeDpc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DeviceObject</span><span class="o">-&gt;</span><span class="n">Dpc</span><span class="p">,</span> <span class="n">sub_11266</span><span class="p">,</span> <span class="n">DeviceObject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v6</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">KeNumberProcessors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">P</span> <span class="o">=</span> <span class="n">ExAllocatePool</span><span class="p">(</span><span class="n">NonPagedPool</span><span class="p">,</span> <span class="mi">32</span> <span class="o">*</span> <span class="o">*</span><span class="n">v6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">P</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">v7</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">KeNumberProcessors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Interval</span><span class="o">.</span><span class="n">QuadPart</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000000</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">v8</span> <span class="o">=</span> <span class="o">*</span><span class="n">v7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">do</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">v9</span> <span class="o">=</span> <span class="p">(</span><span class="n">struct</span> <span class="n">_KDPC</span> <span class="o">*</span><span class="p">)((</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="n">P</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">Number</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">KeInitializeDpc</span><span class="p">(</span><span class="n">v9</span><span class="p">,</span> <span class="n">sub_113E8</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">KeSetTargetProcessorDpc</span><span class="p">(</span><span class="n">v9</span><span class="p">,</span> <span class="n">Number</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">KeInsertQueueDpc</span><span class="p">(</span><span class="n">v9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">KeDelayExecutionThread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Interval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">v10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">KeNumberProcessors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="n">Number</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="k">while</span> <span class="p">(</span> <span class="n">Number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">v10</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">ExFreePoolWithTag</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">IoDeleteDevice</span><span class="p">(</span><span class="n">DriverObject</span><span class="o">-&gt;</span><span class="n">DeviceObject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">DbgPrint</span><span class="p">(</span><span class="s2">&#34;IoCreateDevice Error</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">NTSTATUS</span><span class="p">)</span><span class="n">P</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Mình thấy đoạn <code>DbgPrint(&quot;IoCreateDevice Error\n&quot;);</code> nên cơ bản là cái file này sẽ tạo <code>IoCreateDevice</code> rồi check và gửi thông tin cho file <code>WindowKernel</code>.</p>
<p>Check kĩ file, mình thấy có vài hàm khả nghi:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall sub_111DC(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  bool v2; // zf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  result = 1;
</span></span><span class="line"><span class="cl">  if ( dword_1300C != 1 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    switch ( dword_13034 )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      case 0:
</span></span><span class="line"><span class="cl">      case 2:
</span></span><span class="line"><span class="cl">      case 4:
</span></span><span class="line"><span class="cl">      case 6:
</span></span><span class="line"><span class="cl">        goto LABEL_3;
</span></span><span class="line"><span class="cl">      case 1:
</span></span><span class="line"><span class="cl">        v2 = a1 == -91;
</span></span><span class="line"><span class="cl">        goto LABEL_6;
</span></span><span class="line"><span class="cl">      case 3:
</span></span><span class="line"><span class="cl">        v2 = a1 == -110;
</span></span><span class="line"><span class="cl">        goto LABEL_6;
</span></span><span class="line"><span class="cl">      case 5:
</span></span><span class="line"><span class="cl">        v2 = a1 == -107;
</span></span><span class="line"><span class="cl">LABEL_6:
</span></span><span class="line"><span class="cl">        if ( !v2 )
</span></span><span class="line"><span class="cl">          goto LABEL_7;
</span></span><span class="line"><span class="cl">LABEL_3:
</span></span><span class="line"><span class="cl">        ++dword_13034;
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">      case 7:
</span></span><span class="line"><span class="cl">        if ( a1 == -80 )
</span></span><span class="line"><span class="cl">          dword_13034 = 100;
</span></span><span class="line"><span class="cl">        else
</span></span><span class="line"><span class="cl">LABEL_7:
</span></span><span class="line"><span class="cl">          dword_1300C = 1;
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">      default:
</span></span><span class="line"><span class="cl">        result = sub_11156(a1);
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall sub_11156(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  bool v2; // zf
</span></span><span class="line"><span class="cl">  char v3; // [esp+8h] [ebp+8h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v3 = a1 ^ 0x12;
</span></span><span class="line"><span class="cl">  result = dword_13034 - 100;
</span></span><span class="line"><span class="cl">  switch ( dword_13034 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    case &#39;d&#39;:
</span></span><span class="line"><span class="cl">    case &#39;f&#39;:
</span></span><span class="line"><span class="cl">    case &#39;h&#39;:
</span></span><span class="line"><span class="cl">    case &#39;j&#39;:
</span></span><span class="line"><span class="cl">      goto LABEL_2;
</span></span><span class="line"><span class="cl">    case &#39;e&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == -78;
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case &#39;g&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == -123;
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case &#39;i&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == -93;
</span></span><span class="line"><span class="cl">LABEL_4:
</span></span><span class="line"><span class="cl">      if ( !v2 )
</span></span><span class="line"><span class="cl">        goto LABEL_5;
</span></span><span class="line"><span class="cl">LABEL_2:
</span></span><span class="line"><span class="cl">      ++dword_13034;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    case &#39;k&#39;:
</span></span><span class="line"><span class="cl">      if ( v3 == -122 )
</span></span><span class="line"><span class="cl">        dword_13034 = 200;
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">LABEL_5:
</span></span><span class="line"><span class="cl">        dword_1300C = 1;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    default:
</span></span><span class="line"><span class="cl">      result = sub_110D0(v3);
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall sub_110D0(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  char v2; // cl
</span></span><span class="line"><span class="cl">  bool v3; // zf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  result = dword_13034 - 200;
</span></span><span class="line"><span class="cl">  v2 = a1 ^ 5;
</span></span><span class="line"><span class="cl">  switch ( dword_13034 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    case 200:
</span></span><span class="line"><span class="cl">    case 202:
</span></span><span class="line"><span class="cl">    case 204:
</span></span><span class="line"><span class="cl">    case 206:
</span></span><span class="line"><span class="cl">      goto LABEL_2;
</span></span><span class="line"><span class="cl">    case 201:
</span></span><span class="line"><span class="cl">      v3 = v2 == -76;
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case 203:
</span></span><span class="line"><span class="cl">    case 205:
</span></span><span class="line"><span class="cl">      v3 = v2 == -113;
</span></span><span class="line"><span class="cl">LABEL_4:
</span></span><span class="line"><span class="cl">      if ( v3 )
</span></span><span class="line"><span class="cl">        goto LABEL_2;
</span></span><span class="line"><span class="cl">      goto LABEL_10;
</span></span><span class="line"><span class="cl">    case 207:
</span></span><span class="line"><span class="cl">      if ( v2 != -78 )
</span></span><span class="line"><span class="cl">        goto LABEL_10;
</span></span><span class="line"><span class="cl">      dword_13024 = 1;
</span></span><span class="line"><span class="cl">LABEL_2:
</span></span><span class="line"><span class="cl">      ++dword_13034;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    case 208:
</span></span><span class="line"><span class="cl">      dword_13024 = 0;
</span></span><span class="line"><span class="cl">LABEL_10:
</span></span><span class="line"><span class="cl">      dword_1300C = 1;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    default:
</span></span><span class="line"><span class="cl">      return result;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Cả 3 hàm này đều dùng chung 1 biến count là <code>dword_13024</code> và nó sẽ là duyệt từ đầu input tới cuối.</p>
<p>Quay trở lại hàm đầu tiên, thì biến count bắt đầu từ 0 =&gt; hàm check đầu tiên, tiếp theo nó set <code>count = 100</code> và qua hàm thứ 2 thì <code>count-100</code>và dử dụng nó =&gt; xem như input được chia thành 3 đoạn và kiểm tra bằng 3 hàm.</p>
<p>Xem đầu vào của hàm đầu tiên:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void __stdcall sub_11266(_KDPC *Dpc, PVOID DeferredContext, PVOID SystemArgument1, PVOID SystemArgument2)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  char v4; // al
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v4 = READ_PORT_UCHAR((PUCHAR)0x60);
</span></span><span class="line"><span class="cl">  first(v4);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Nó nhận tính hiệu từ API <code>READ_PORT_UCHAR</code> , nếu tra trên mạng thì nó sẽ nhận char từ port 60 và trả về <code> scancodes</code>.</p>
<p>Các bạn xem <code>scancodes-keys map table</code> <a href="https://wiki.osdev.org/PS/2_Keyboard">tại đây</a>.</p>
<p>Dựa theo tín hiệu và hàm check đầu tiên, mình tìm được 4 kí tự đầu:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall first(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  bool v2; // zf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  result = 1;
</span></span><span class="line"><span class="cl">  if ( dword_1300C != 1 )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    switch ( count )
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      case 0:
</span></span><span class="line"><span class="cl">      case 2:
</span></span><span class="line"><span class="cl">      case 4:
</span></span><span class="line"><span class="cl">      case 6:
</span></span><span class="line"><span class="cl">        goto LABEL_3;
</span></span><span class="line"><span class="cl">      case 1:
</span></span><span class="line"><span class="cl">        v2 = a1 == (char)0xA5;                  // K realeased (phím K)
</span></span><span class="line"><span class="cl">        goto LABEL_6;
</span></span><span class="line"><span class="cl">      case 3:
</span></span><span class="line"><span class="cl">        v2 = a1 == (char)0x92;                  // E realeased
</span></span><span class="line"><span class="cl">        goto LABEL_6;
</span></span><span class="line"><span class="cl">      case 5:
</span></span><span class="line"><span class="cl">        v2 = a1 == (char)0x95;                  // Y realeased
</span></span><span class="line"><span class="cl">LABEL_6:
</span></span><span class="line"><span class="cl">        if ( !v2 )
</span></span><span class="line"><span class="cl">          goto LABEL_7;
</span></span><span class="line"><span class="cl">LABEL_3:
</span></span><span class="line"><span class="cl">        ++count;
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">      case 7:
</span></span><span class="line"><span class="cl">        if ( a1 == (char)0xB0 )                 // B realeased
</span></span><span class="line"><span class="cl">          count = 100;
</span></span><span class="line"><span class="cl">        else
</span></span><span class="line"><span class="cl">LABEL_7:
</span></span><span class="line"><span class="cl">          dword_1300C = 1;
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">      default:
</span></span><span class="line"><span class="cl">        result = second(a1);
</span></span><span class="line"><span class="cl">        break;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Tương tự:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall second(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  bool v2; // zf
</span></span><span class="line"><span class="cl">  char v3; // [esp+8h] [ebp+8h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v3 = a1 ^ 0x12;
</span></span><span class="line"><span class="cl">  result = count - 100;
</span></span><span class="line"><span class="cl">  switch ( count )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    case &#39;d&#39;:
</span></span><span class="line"><span class="cl">    case &#39;f&#39;:
</span></span><span class="line"><span class="cl">    case &#39;h&#39;:
</span></span><span class="line"><span class="cl">    case &#39;j&#39;:
</span></span><span class="line"><span class="cl">      goto LABEL_2;
</span></span><span class="line"><span class="cl">    case &#39;e&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == (char)0xB2;                    // 0x12^0xB2 = 0xA0 =&gt; D realeased
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case &#39;g&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == (char)0x85;                    // 0x12^0x85 = 0x97 =&gt; I realeased
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case &#39;i&#39;:
</span></span><span class="line"><span class="cl">      v2 = v3 == (char)0xA3;                    // 0x12^0xA3 = 0xB1 =&gt; N realeased
</span></span><span class="line"><span class="cl">LABEL_4:
</span></span><span class="line"><span class="cl">      if ( !v2 )
</span></span><span class="line"><span class="cl">        goto LABEL_5;
</span></span><span class="line"><span class="cl">LABEL_2:
</span></span><span class="line"><span class="cl">      ++count;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    case &#39;k&#39;:
</span></span><span class="line"><span class="cl">      if ( v3 == (char)0x86 )                   // 0x12^0x86 = 0x94 =&gt; T realeased
</span></span><span class="line"><span class="cl">        count = 200;
</span></span><span class="line"><span class="cl">      else
</span></span><span class="line"><span class="cl">LABEL_5:
</span></span><span class="line"><span class="cl">        dword_1300C = 1;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    default:
</span></span><span class="line"><span class="cl">      result = last(v3);
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int __stdcall last(char a1)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  int result; // eax
</span></span><span class="line"><span class="cl">  char v2; // cl
</span></span><span class="line"><span class="cl">  bool v3; // zf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  result = count - 200;
</span></span><span class="line"><span class="cl">  v2 = a1 ^ 5;
</span></span><span class="line"><span class="cl">  switch ( count )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    case 200:
</span></span><span class="line"><span class="cl">    case 202:
</span></span><span class="line"><span class="cl">    case 204:
</span></span><span class="line"><span class="cl">    case 206:
</span></span><span class="line"><span class="cl">      goto LABEL_2;
</span></span><span class="line"><span class="cl">    case 201:
</span></span><span class="line"><span class="cl">      v3 = v2 == (char)0xB4;                    // 0xB4^0x12^5 = 0xA3 =&gt; T
</span></span><span class="line"><span class="cl">      goto LABEL_4;
</span></span><span class="line"><span class="cl">    case 203:                                   // 0x8F^0x12^5 = 0x98 =&gt; O realeased
</span></span><span class="line"><span class="cl">    case 205:                                   // 0x8F^0x12^5 = 0x98 =&gt; O realeased
</span></span><span class="line"><span class="cl">      v3 = v2 == (char)0x8F;
</span></span><span class="line"><span class="cl">LABEL_4:
</span></span><span class="line"><span class="cl">      if ( v3 )
</span></span><span class="line"><span class="cl">        goto LABEL_2;
</span></span><span class="line"><span class="cl">      goto LABEL_10;
</span></span><span class="line"><span class="cl">    case 207:
</span></span><span class="line"><span class="cl">      if ( v2 != (char)0xB2 )                   // 0xB2^0x12^5 = 0xA5 =&gt; K realeased
</span></span><span class="line"><span class="cl">        goto LABEL_10;
</span></span><span class="line"><span class="cl">      dword_13024 = 1;
</span></span><span class="line"><span class="cl">LABEL_2:
</span></span><span class="line"><span class="cl">      ++count;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    case 208:
</span></span><span class="line"><span class="cl">      dword_13024 = 0;
</span></span><span class="line"><span class="cl">LABEL_10:
</span></span><span class="line"><span class="cl">      dword_1300C = 1;
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    default:
</span></span><span class="line"><span class="cl">      return result;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Theo chỉ dẫn trong file readme.txt, tìm được key:<code>keybdinthook</code></p>

      
    </div>
    <footer class="article-footer">
      
        






<blockquote class="article-copyright">
  
    <p><strong><span class="icon-user icon"></span>Author：</strong>Le Phu Duc @ You just landed on Jinn&#39;s site, let&#39;s find out..</p>
  
  
  
    <p><strong><span class="icon-pencil icon"></span>Article title：</strong>reversing.kr</p>
  
  
    <p><strong><span class="icon-calendar icon"></span>Publication time：</strong>2022-05-01 00:00:00</p>
  
  
  
    <p>
      <strong><span class="icon-copyright icon"></span>Copyright Noice：</strong>All articles on this blog, unless otherwise stated, are licensed under
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"
        ><span class="icon-creative-commons"></span>BY-NC-SA</a
      >
      the license agreement. Please credit the source when sharing.！
    </p>
    <span class="icon-creative-commons article-copyright-bg"></span>
  
</blockquote>

      

      
        <div class="sponsor-wrapper">
  <div class="sponsor-button-wrapper">
    <div class="sponsor-icon rotate"></div>
    <div class="sponsor-title">Sponsor</div>
    <div class="sponsor-icon rotate"></div>
  </div>
  <div class="sponsor-tip">Please buy author a cup of coffee!</div>
  
    <div class="sponsor-qr">
      
        <div class="sponsor-qr-image-wrapper">
          <img src="/images/bmc_qr_lephuduc.png" alt="buymeacoffee.com/lephuduc" width="200" />
          <p class="sponsor-qr-name">buymeacoffee.com/lephuduc</p>
        </div>
      
    </div>
  
</div>
      

      
        

<div class="share-wrapper">
  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:1313/post/reversing.kr/" target="_blank" rel="noopener noreferrer" title="reversing.kr">
      <div class="share-icon icon icon-facebook">
        
      </div>
    </a>
  
    <a href="https://twitter.com/intent/tweet?url=http://localhost:1313/post/reversing.kr/&amp;text=reversing.kr&amp;via=http://localhost:1313/" target="_blank" rel="noopener noreferrer" title="reversing.kr">
      <div class="share-icon icon icon-twitter">
        
      </div>
    </a>
  
    <a href="https://www.linkedin.com/shareArticle?url=http://localhost:1313/post/reversing.kr/&amp;title=reversing.kr&amp;summary=Write%20up%20for%20rev%20problem%20in%20reversing.kr&amp;mini=true&amp;ro=true" target="_blank" rel="noopener noreferrer" title="reversing.kr">
      <div class="share-icon icon icon-linkedin">
        
      </div>
    </a>
  
    <a href="https://www.reddit.com/submit?url=http://localhost:1313/post/reversing.kr/&amp;title=reversing.kr" target="_blank" rel="noopener noreferrer" title="reversing.kr">
      <div class="share-icon icon icon-reddit">
        
      </div>
    </a>
  
</div>
      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/reverse"
        rel="tag"
        >REVERSE</a
      >
    </li>
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/wargame"
        rel="tag"
        >WARGAME</a
      >
    </li>
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/vietnamese"
        rel="tag"
        >VIETNAMESE</a
      >
    </li>
  
</ul>

    </footer>
  </div>
  
    
  <nav
    id="article-nav"
    data-aos="fade-up"
  >
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          <img
            data-src="/images/post_covers/picoctf2021.jpeg"
            data-sizes="auto"
            alt="PicoCTF 2022"
            class="lazyload"
          />
        
        <a href="http://localhost:1313/post/picoctf2021/"></a>
        <div class="article-nav-caption">Older</div>
        <h3 class="article-nav-title">
          
            PicoCTF 2022
          
        </h3>
      </div>
    

    
      <div class="article-nav-link-wrap article-nav-link-right">
        
          <img
            data-src="/images/post_covers/corctf2022.jpeg"
            data-sizes="auto"
            alt="CORCTF 2022"
            class="lazyload"
          />
        
        <a href="http://localhost:1313/post/corctf2022/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">
          
            CORCTF 2022
          
        </h3>
      </div>
    
  </nav>


  
</article>










</section>
        </div>
        
        
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
      2022 -
      2025
      <span class="footer-info-sep rotate"></span>
      Le Phu Duc
    </div>
    
    
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            52.1k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          04:13
        </span>
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar">
        <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#easy-crack---100pts">Easy Crack - 100pts</a></li>
    <li><a href="#easy-keygen---100pts">Easy Keygen - 100pts</a></li>
    <li><a href="#easy-unpack---100pts">Easy Unpack - 100pts</a></li>
    <li><a href="#easy-elf---100pts">Easy ELF - 100pts</a></li>
    <li><a href="#replace---150pts">Replace - 150pts</a></li>
    <li><a href="#imageprc---120pts">ImagePrc - 120pts</a></li>
    <li><a href="#music-player---150pts">Music Player - 150pts</a></li>
    <li><a href="#cshop---120pts">CSHOP - 120pts</a></li>
    <li><a href="#position---160pts">Position - 160pts</a></li>
    <li><a href="#direct3d-fps---140pts">Direct3D FPS - 140pts</a></li>
    <li><a href="#multiplicative---170pts">Multiplicative - 170pts</a></li>
    <li><a href="#ransomware---120pts">ransomware - 120pts</a></li>
    <li><a href="#hateintel---150pts">HateIntel - 150pts</a></li>
    <li><a href="#x64-lotto---140pts">x64 Lotto - 140pts</a></li>
    <li><a href="#autohotkey1---130pts">AutoHotKey1 - 130pts</a></li>
    <li><a href="#csharp---160pts">CSHARP - 160pts</a></li>
    <li><a href="#twist1---190pts">Twist1 - 190pts</a></li>
    <li><a href="#pepassword---150pts">PEpassword - 150pts</a>
      <ul>
        <li><a href="#originalexe">Original.exe:</a></li>
        <li><a href="#packedexe">Packed.exe:</a></li>
      </ul>
    </li>
    <li><a href="#windowkernel---220pts">WindowKernel - 220pts</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#approach">Approach</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
      </div>
      <div class="sidebar-common-sidebar hidden">
        
<div class="sidebar-author">
  <img
    data-src="/avatar/shiba.jpg"
    data-sizes="auto"
    alt="Le Phu Duc"
    class="lazyload"
  />
  <div class="sidebar-author-name">Le Phu Duc</div>
  <div class="sidebar-description">a.k.a Jinn</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">17</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      1
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">6</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-discord sidebar-social-icon">
      <a
        href="https://discordapp.com/users/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-facebook sidebar-social-icon">
      <a
        href="https://www.facebook.com/lephuduc0309"
        itemprop="url"
        target="_blank"
        aria-label="facebook"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-instagram sidebar-social-icon">
      <a
        href="https://www.instagram.com/le.phuduc"
        itemprop="url"
        target="_blank"
        aria-label="instagram"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/lephuduc"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-twitter sidebar-social-icon">
      <a
        href="https://twitter.com/lephuduck"
        itemprop="url"
        target="_blank"
        aria-label="twitter"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe628;
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe604;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/achievements"
        aria-label="Achievements"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">Achievements</div>
    </div>
  
</div>

      </div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="/js/main.js" ></script>
      



  





  
      
      <script src="/js/aos.js" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="/js/pjax_main.js" data-pjax></script>
      



  <script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "",
        apiKey: "",
        indexName: "",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": "搜索.....",
          "hits_empty": "未发现与 「${query}」相关内容",
          "hits_stats": "找到${hits}条结果（用时 ${time} ms）"
        }
      }
    };
  </script>
  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    defer
    
    
    
    integrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"
  ></script>


  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js"
    defer
    
    
    
    integrity="sha384-hHJCflT4KBLQyHfKO9vpstIcFKn/Y&#43;KHTORelMMEn7mOp2AVPp&#43;7fr03dLgZiV3J" crossorigin="anonymous"
  ></script>


  





  
      
      <script src="/js/algolia_search.js" ></script>
      




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js"
    
    
    
    
    integrity="sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv" crossorigin="anonymous"
  ></script>


<script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"#c0971d\",\"#caa02f\",\"#d4aa40\",\"#ddbb62\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"#f4e74d\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>



  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js"
    
    
    
    
    integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE/jMSCxD&#43;jAPU55x/jj3wlf" crossorigin="anonymous"
  ></script>


  <script>
    function loadScripts(scripts, index) {
      if (index < scripts.length) {
        const script = scripts[index];
        const src = script.getAttribute('src');

        const loadScript = (scriptContent) => {
          return new Promise((resolve, reject) => {
            const scriptElement = document.createElement('script');
            if (script.type) {
              scriptElement.type = script.type;
            }
            if (script.src) {
              scriptElement.src = script.src;
              scriptElement.onload = resolve;
              scriptElement.onerror = reject;
            }
            if (scriptContent) {
              scriptElement.text = scriptContent;
            }
            document.head.appendChild(scriptElement);
            if (!script.src) {
              resolve();
            }
          })
          
        }

        ;(src ? loadScript() : loadScript(script.text))
          .then(() => loadScripts(scripts, index + 1))
          .catch(error => {
            console.error(`Failed to load script: ${src || 'inline script'}`, error);
            loadScripts(scripts, index + 1);
          });
      }
    }
    window.Pjax &&
      new window.Pjax({
        selectors: [
          "#header>img",
          "#header>picture",
          "head title",
          "#header-title",
          "#subtitle-wrap",
          "#main",
          "#content",
          ".sidebar-widget",
          ".sidebar-wrapper",
          "#mobile-nav",
          "#lazy-script",
        ],
        switches: {
          "#content": function(oldEl, newEl) {
            
            oldEl.className = newEl.className;
            this.onSwitch();
          },
          "#header-title": Pjax.switches.outerHTML,
          "#subtitle-wrap": Pjax.switches.outerHTML,
          "#main": function (oldEl, newEl) {
            const scripts = [...newEl.querySelectorAll("script")];
            loadScripts(scripts, 0);
            oldEl.outerHTML = newEl.outerHTML;
            this.onSwitch();
          },
          "#mobile-nav": Pjax.switches.outerHTML,
          "#lazy-script": function (oldEl, newEl) {
            const scripts = [...newEl.querySelectorAll("script")];
            loadScripts(scripts, 0);
            oldEl.innerHTML = newEl.innerHTML;
            this.onSwitch();
          },
        },
        cacheBust: false,
      });
  </script>
  





  
      
      <script src="/js/pjax.js" ></script>
      







<div id="lazy-script">
  <div>
    
      
      
        
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "Le Phu Duc",
          title: "reversing.kr",
          url: "http:\/\/localhost:1313\/post\/reversing.kr\/",
          description: "Write up for rev problem in reversing.kr",
          cover: "http:\/\/localhost:1313\/images\/newjeans3.jpg",
        };
      </script>
    
    
    
      





  
      
      <script src="/js/insert_highlight.js" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












      
    
    
  </div>
</div>




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    
    async
    
    
    integrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"
  ></script>





  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>





  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js"
    
    
    
    
    integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr&#43;h5UfruuRL/aORyw&#43;5&#43;HZoU6e" crossorigin="anonymous"
  ></script>


  
    <script>
      const ap = new APlayer({
          theme: "var(--color-link)",
          container: document.getElementById('aplayer'),
          audio: JSON.parse("[{\"artist\":\"Lady Gaga, Bruno Mars\",\"cover\":\"/images/song_covers/die_with_a_smile.jpg\",\"lrc\":\"/songs/die_with_a_smile.lrc\",\"name\":\"Die With A Smile\",\"url\":\"/songs/die_with_a_smile.mp3\"},{\"artist\":\"NewJeans (뉴진스)\",\"cover\":\"/images/song_covers/ditto.jpg\",\"lrc\":\"/songs/ditto.lrc\",\"name\":\"Ditto\",\"url\":\"/songs/ditto.mp3\"},{\"artist\":\"Goose house\",\"cover\":\"/images/song_covers/hikarunara.jpg\",\"lrc\":\"/songs/hikarunara.lrc\",\"name\":\"光るなら\",\"url\":\"/songs/hikarunara.mp3\"},{\"artist\":\"back number\",\"cover\":\"/images/song_covers/takaneno_hanakosan.png\",\"lrc\":\"/songs/takaneno_hanakosan.lrc\",\"name\":\"高嶺の花子さん\",\"url\":\"/songs/Takaneno_Hanakosan.mp3\"}]") || [],
          fixed:  null  || false,
          autoplay:  false  || false,
          loop: 'all' || 'all',
          order: '' || 'list',
          preload: '' || 'auto',
          volume:  null  || 0.7,
          mutex:  null  || true,
          listFolded:  false  || false,
          lrcType:  3  || 0,
      });
    </script>
  



  </body>
</html>
